"use strict";(self.webpackChunkmesodocs=self.webpackChunkmesodocs||[]).push([[83],{4137:(e,n,t)=>{t.d(n,{Zo:()=>i,kt:()=>g});var r=t(7294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,r,l=function(e,n){if(null==e)return{};var t,r,l={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var u=r.createContext({}),m=function(e){var n=r.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},i=function(e){var n=m(e.components);return r.createElement(u.Provider,{value:n},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,l=e.mdxType,o=e.originalType,u=e.parentName,i=a(e,["components","mdxType","originalType","parentName"]),d=m(t),p=l,g=d["".concat(u,".").concat(p)]||d[p]||c[p]||o;return t?r.createElement(g,s(s({ref:n},i),{},{components:t})):r.createElement(g,s({ref:n},i))}));function g(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var o=t.length,s=new Array(o);s[0]=p;var a={};for(var u in n)hasOwnProperty.call(n,u)&&(a[u]=n[u]);a.originalType=e,a[d]="string"==typeof e?e:l,s[1]=a;for(var m=2;m<o;m++)s[m]=t[m];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},3351:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>s,default:()=>c,frontMatter:()=>o,metadata:()=>a,toc:()=>m});var r=t(7462),l=(t(7294),t(4137));const o={title:"Environnements logiciels",sidebar_position:5},s="INTRODUCTION",a={unversionedId:"code_form/hedy/module",id:"code_form/hedy/module",title:"Environnements logiciels",description:"Le syst\xe8me de Modules est un outil qui simplifie l'initialisation du shell et permet aux utilisateurs et utilisatrices de modifier leur environnement facilement avec des fichiers de modules.",source:"@site/docs/code_form/hedy/module.md",sourceDirName:"code_form/hedy",slug:"/code_form/hedy/module",permalink:"/documentation/user-documentation/code_form/hedy/module",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Environnements logiciels",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Lancer un calcul",permalink:"/documentation/user-documentation/code_form/hedy/jobs"},next:{title:"Noeud de visulation",permalink:"/documentation/user-documentation/code_form/hedy/visu"}},u={},m=[{value:"module list",id:"module-list",level:2},{value:"module load",id:"module-load",level:2},{value:"module remove",id:"module-remove",level:2},{value:"module purge",id:"module-purge",level:2},{value:"module switch",id:"module-switch",level:2},{value:"module avail",id:"module-avail",level:2},{value:".bashrc / .cshrc / .zshrc",id:"bashrc--cshrc--zshrc",level:2}],i={toc:m},d="wrapper";function c(e){let{components:n,...t}=e;return(0,l.kt)(d,(0,r.Z)({},i,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"introduction"},"INTRODUCTION"),(0,l.kt)("p",null,"Le syst\xe8me de ",(0,l.kt)("a",{parentName:"p",href:"https://modules.readthedocs.io/en/latest/#"},"Modules")," est un outil qui simplifie l'initialisation du shell et permet aux utilisateurs et utilisatrices de modifier leur environnement facilement avec des fichiers de modules."),(0,l.kt)("p",null,"Chaque fichier de module contient les informations requises pour configurer le shell pour une application sp\xe9cifique. Plusieurs modules sont pr\xe9-install\xe9s sur ",(0,l.kt)("strong",{parentName:"p"},"Hedy"),"."),(0,l.kt)("p",null,"Par d\xe9faut, le module ",(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("a",{parentName:"strong",href:"jobs"},"slurm/slurm"))," (notre gestionnaire de ressources, indispensable pour soumettre des jobs) est charg\xe9 par d\xe9faut dans l'environnement de toutes les personnes se connectant au cluster."),(0,l.kt)("h1",{id:"utilisation"},"UTILISATION"),(0,l.kt)("h2",{id:"module-list"},"module list"),(0,l.kt)("p",null,"Pour lister les modules charg\xe9s dans votre environnement, vous pouvez utiliser la commande ",(0,l.kt)("strong",{parentName:"p"},"module list")," (ou son raccourci ",(0,l.kt)("strong",{parentName:"p"},"ml list"),") :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"user@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)\n")),(0,l.kt)("p",null,"On voit ici que le module ",(0,l.kt)("strong",{parentName:"p"},"slurm/slurm")," estcharg\xe9, ce qui nous permettra d'utiliser cette application."),(0,l.kt)("h2",{id:"module-load"},"module load"),(0,l.kt)("p",null,"Prenons l'exemple de ",(0,l.kt)("strong",{parentName:"p"},"openmpi"),". Voici ce qui se passe si vous essayez de l'utiliser sans charger de module :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"user@hedy:~$ mpirun\n-bash: mpirun: command not found\nuser@hedy:~$ which mpirun\n/usr/bin/which: no mpirun in (/usr/local/bin/di:/nfs/mesonet/home/users/hal/HPC_tools/utilities:/nfs/mesonet/home/users/hal/.local/bin:/nfs/mesonet/sw/slurm/slurm-24.05.0/bin:/nfs/mesonet/sw/modules/modules-5.4.0/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/nfs/mesonet/home/users/hal/bin:/nfs/mesonet/sw/munge/munge-0.5.16/bin/)\n")),(0,l.kt)("p",null,"Le logiciel n'appara\xeet pas dans votre environnement, et par cons\xe9quent vous ne pouvez pas l'utiliser. Il faut donc charger le bon module avec la commande ",(0,l.kt)("strong",{parentName:"p"},"module load")," (ou son raccourci ",(0,l.kt)("strong",{parentName:"p"},"ml load"),") :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"user@hedy:~$ module load openmpi/5.0.3.rocm-6.1.1\nLoading openmpi/5.0.3.rocm-6.1.1\n  Loading requirement: rocm/6.1.1\nuser@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)   2) rocm/6.1.1(latest)   3) openmpi/5.0.3.rocm-6.1.1\nuser@hedy:~$ which mpirun\n/nfs/mesonet/sw/openmpi/openmpi-5.0.3.rocm-6.1.1/bin/mpirun\n")),(0,l.kt)("p",null,"On voit que maintenant ",(0,l.kt)("strong",{parentName:"p"},"openmpi")," est utilisable. On constate \xe9galement que tous les autres modules desquels ",(0,l.kt)("strong",{parentName:"p"},"openmpi")," d\xe9pend ont \xe9t\xe9 charg\xe9 automatiquement. Pour d\xe9sactiver l'affichage du message, vous pouvez utiliser l'option ",(0,l.kt)("strong",{parentName:"p"},"-q")," (ou ",(0,l.kt)("strong",{parentName:"p"},"--quiet"),") :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"\nuser@hedy:~$ module -q load openmpi/5.0.3.rocm-6.1.1\nuser@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)   2) rocm/6.1.1(latest)   3) openmpi/5.0.3.rocm-6.1.1\n")),(0,l.kt)("p",null,"Le message ne s'est pas affich\xe9, mais tous les modules sont bien charg\xe9s. Cela peut servir pour all\xe9ger les logs de vos jobs."),(0,l.kt)("h2",{id:"module-remove"},"module remove"),(0,l.kt)("p",null,"Lorsque vous ne voulez plus utiliser un module, vous pouvez le supprimer de votre environnement avec la commande ",(0,l.kt)("strong",{parentName:"p"},"module remove")," (ou ses raccourcis ",(0,l.kt)("strong",{parentName:"p"},"module rm")," ou ",(0,l.kt)("strong",{parentName:"p"},"ml rm"),"). Dans notre exemple, le module ",(0,l.kt)("strong",{parentName:"p"},"openmpi/5.0.3.rocm-6.1.1")," n'est plus n\xe9cessaire :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"user@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)   2) rocm/6.1.1(latest)   3) openmpi/5.0.3.rocm-6.1.1\nuser@hedy:~$ module remove openmpi/5.0.3.rocm-6.1.1\nUnloading openmpi/5.0.3.rocm-6.1.1\n  Unloading useless requirement: rocm/6.1.1\nuser@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)\n")),(0,l.kt)("p",null,'Module va g\xe9rer de mani\xe8re "intelligente" les d\xe9pendances. Il a supprim\xe9 les d\xe9pendances automatiquement. Si vous aviez charg\xe9 le module ',(0,l.kt)("strong",{parentName:"p"},"rocm/6.1.1")," avant de charger le module ",(0,l.kt)("strong",{parentName:"p"},"openmpi/5.0.3.rocm-6.1.1"),", ce dernier ne chargera que l'autre d\xe9pendance manquante. Lors de la suppression, le module ",(0,l.kt)("strong",{parentName:"p"},"rocm/6.1.1")," sera conserv\xe9 :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"user@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)   2) rocm/6.1.1(latest)\nuser@hedy:~$ module load openmpi/5.0.3.rocm-6.1.1\nuser@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)   2) rocm/6.1.1(latest)   3) openmpi/5.0.3.rocm-6.1.1\nuser@hedy:~$ module rm openmpi/5.0.3.rocm-6.1.1\n  Unloading useless requirement: openmpi/openmpi-3.1.i18\nuser@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)   2) rocm/6.1.1(latest)\n")),(0,l.kt)("p",null,"\xc0 l'inverse, si vous enlevez un module dont d\xe9pend d'autres modules, tous les modules seront d\xe9charg\xe9s :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"user@hedy:~$ module load openmpi/5.0.3.rocm-6.1.1\nLoading openmpi/5.0.3.rocm-6.1.1\n  Loading requirement: rocm/6.1.1\nuser@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)   2) rocm/6.1.1(latest)   3) openmpi/5.0.3.rocm-6.1.1\nuser@hedy:~$ module rm rocm/6.1.1\nUnloading rocm/6.1.1\n  Unloading dependent: openmpi/5.0.3.rocm-6.1.1\n")),(0,l.kt)("h2",{id:"module-purge"},"module purge"),(0,l.kt)("p",null,"Vous pouvez supprimer tous vos modules d'un coup pour repartir sur une base nouvelle avec ",(0,l.kt)("strong",{parentName:"p"},"module purge")," (",(0,l.kt)("strong",{parentName:"p"},"ml purge"),")"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"user@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)   2) rocm/6.1.1(latest)   3) openmpi/5.0.3.rocm-6.1.1   4) gcc/13.2.0(latest)\nuser@hedy:~$ module purge\nUnloading slurm/slurm\n  ERROR: Unload of super-sticky module skipped\nuser@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)\n")),(0,l.kt)("p",null,"Vous pouvez qu'une erreur indique que le module ",(0,l.kt)("strong",{parentName:"p"},"slurm/slurm")," n'a pas pu \xeatre supprim\xe9. C'est tout \xe0 fait normal, ce module \xe9tant indispensable au fonctionnement du centre de calcul, nous avons d\xe9cid\xe9 de le rendre permanent. Si vous ne souhaitez pas voir l'erreur appara\xeetre, vous pouvez utiliser l'option ",(0,l.kt)("strong",{parentName:"p"},"-q")," :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"user@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)   2) rocm/6.1.1(latest)   3) openmpi/5.0.3.rocm-6.1.1   4) gcc/13.2.0(latest)\nuser@hedy:~$ module purge -q\nuser@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)\n")),(0,l.kt)("h2",{id:"module-switch"},"module switch"),(0,l.kt)("p",null,"Il est possible de remplacer un module par un autre avec une seule commande ",(0,l.kt)("strong",{parentName:"p"},"module switch")," (",(0,l.kt)("strong",{parentName:"p"},"ml switch"),") :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"user@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)\nuser@hedy:~$ module load aocl/4.2.0.aocc\nLoading aocl/4.2.0.aocc\n  Loading requirement: rocm/6.1.1\nuser@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)   2) rocm/6.1.1(latest)   3) aocl/4.2.0.aocc\nuser@hedy:~$ module switch aocl/4.2.0.aocc aocl/4.2.0.gcc\nSwitching from aocl/4.2.0.aocc to aocl/4.2.0.gcc\n  Unloading useless requirement: rocm/6.1.1\n  Loading requirement: gcc/13.2.0\nuser@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)   2) gcc/13.2.0(latest)   3) aocl/4.2.0.gcc\n")),(0,l.kt)("p",null,"Ici on remplace le module ",(0,l.kt)("strong",{parentName:"p"},"aocl/4.2.0.aocc")," par le module ",(0,l.kt)("strong",{parentName:"p"},"aocl/4.2.0.gcc"),". Les d\xe9pendances sont g\xe9r\xe9es automatiquement."),(0,l.kt)("h2",{id:"module-avail"},"module avail"),(0,l.kt)("p",null,"La commande ",(0,l.kt)("strong",{parentName:"p"},"module avail")," (",(0,l.kt)("strong",{parentName:"p"},"ml avail"),") permet d'obtenir la liste des modules install\xe9s sur le cluster."),(0,l.kt)("p",null,"La liste peut \xeatre un peu longue et indigeste, il est pr\xe9f\xe9rable d'affiner un peu ses recherches avec le nom d'une application par exemple :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"user@hedy:~$ module avail gcc\n---------------- /nfs/mesonet/sw/modulefiles ----------------\ngcc/9.5.0  gcc/10.5.0  gcc/11.4.0  gcc/12.3.0  gcc/13.2.0(latest)\n")),(0,l.kt)("p",null,"Certains modules ont des tags entre parenth\xe8ses. Ces derniers servent \xe0 identifier rapidement le module le plus r\xe9cent. Quand 2 modules partagent le tag ",(0,l.kt)("em",{parentName:"p"},"latest"),", un autre tag s'ajoute pour les diff\xe9rencier (souvent le compilateur qui a servi a complier l'application)."),(0,l.kt)("p",null,"D'autres modules sont soulign\xe9s. Ces modules repr\xe9sentent les modules qui seront charg\xe9s par d\xe9faut si on ne pr\xe9cise pas de version de module :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"user@hedy:~$ module load gcc\nuser@hedy:~$ module list\nCurrently Loaded Modulefiles:\n 1) slurm/slurm(latest)   2) gcc/gcc-13.2.0(latest)\n")),(0,l.kt)("h2",{id:"bashrc--cshrc--zshrc"},".bashrc / .cshrc / .zshrc"),(0,l.kt)("p",null,"Les fichiers ",(0,l.kt)("strong",{parentName:"p"},".bashrc")," (pour ",(0,l.kt)("a",{parentName:"p",href:"https://www.gnu.org/software/bash"},"bash"),"), ",(0,l.kt)("strong",{parentName:"p"},".cshrc")," (pour ",(0,l.kt)("a",{parentName:"p",href:"https://www.tcsh.org"},"tcsh")," ou csh) et ",(0,l.kt)("strong",{parentName:"p"},".zshrc")," (pour ",(0,l.kt)("a",{parentName:"p",href:"https://www.zsh.org"},"zsh"),") permettent une personalisation du shell. Vous pouvez y ins\xe9rer des commandes qui seront lanc\xe9es \xe0 chaque connexion. Il est ainsi possible de charger directement les modules qui vous int\xe9ressent dans ce fichier de configuration. Vous pouvez \xe9diter ce fichier avec n'importe quel \xe9diteur de texte install\xe9 sur ",(0,l.kt)("strong",{parentName:"p"},"H")," :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"vim ~/.bashrc\n")),(0,l.kt)("p",null,"Ces modules seront \xe9galement utilis\xe9s pour vos jobs, donc il n'est plus n\xe9cessaire de les charger manuellement dans vos scripts de soumissions."),(0,l.kt)("p",null,"Voici un exemple de ",(0,l.kt)("strong",{parentName:"p"},".bashrc")," qui charge des modules automatiquement :"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"# .bashrc\n\n# Source global definitions\nif [ -f /etc/bashrc ]; then\n        . /etc/bashrc\nfi\n\nsource /usr/local/configfiles/bashrc.default\n\nmodule load -s gcc/gcc-13.2.0\nmodule load -s openmpi/5.0.3.rocm-6.1.1\nmodule load -s cmake/3.29.5\n")))}c.isMDXComponent=!0}}]);