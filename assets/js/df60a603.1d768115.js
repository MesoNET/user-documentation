"use strict";(self.webpackChunkmesodocs=self.webpackChunkmesodocs||[]).push([[6477],{4137:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>b});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),s=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):u(u({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(i.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=s(n),d=r,b=p["".concat(i,".").concat(d)]||p[d]||m[d]||o;return n?a.createElement(b,u(u({ref:t},c),{},{components:n})):a.createElement(b,u({ref:t},c))}));function b(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,u=new Array(o);u[0]=d;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[p]="string"==typeof e?e:r,u[1]=l;for(var s=2;s<o;s++)u[s]=n[s];return a.createElement.apply(null,u)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},425:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(7294),r=n(6010);const o={tabItem:"tabItem_Ymn6"};function u(e){let{children:t,hidden:n,className:u}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(o.tabItem,u),hidden:n},t)}},3992:(e,t,n)=>{n.d(t,{Z:()=>N});var a=n(7462),r=n(7294),o=n(6010),u=n(2957),l=n(6550),i=n(5238),s=n(3609),c=n(2560);function p(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}function m(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,s.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function d(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function b(e){let{queryString:t=!1,groupId:n}=e;const a=(0,l.k6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,i._X)(o),(0,r.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(a.location.search);t.set(o,e),a.replace({...a.location,search:t.toString()})}),[o,a])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,o=m(e),[u,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!d({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:o}))),[i,s]=b({queryString:n,groupId:a}),[p,f]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,o]=(0,c.Nk)(n);return[a,(0,r.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:a}),k=(()=>{const e=i??p;return d({value:e,tabValues:o})?e:null})();(0,r.useLayoutEffect)((()=>{k&&l(k)}),[k]);return{selectedValue:u,selectValue:(0,r.useCallback)((e=>{if(!d({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),s(e),f(e)}),[s,f,o]),tabValues:o}}var k=n(1048);const h={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function v(e){let{className:t,block:n,selectedValue:l,selectValue:i,tabValues:s}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,u.o5)(),m=e=>{const t=e.currentTarget,n=c.indexOf(t),a=s[n].value;a!==l&&(p(t),i(a))},d=e=>{let t=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t)},s.map((e=>{let{value:t,label:n,attributes:u}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>c.push(e),onKeyDown:d,onClick:m},u,{className:(0,o.Z)("tabs__item",h.tabItem,u?.className,{"tabs__item--active":l===t})}),n??t)})))}function g(e){let{lazy:t,children:n,selectedValue:a}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},o.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function x(e){const t=f(e);return r.createElement("div",{className:(0,o.Z)("tabs-container",h.tabList)},r.createElement(v,(0,a.Z)({},e,t)),r.createElement(g,(0,a.Z)({},e,t)))}function N(e){const t=(0,k.Z)();return r.createElement(x,(0,a.Z)({key:String(t)},e))}},9262:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>b,frontMatter:()=>l,metadata:()=>s,toc:()=>p});var a=n(7462),r=(n(7294),n(4137)),o=n(3992),u=n(425);const l={title:"Lancer un calcul",sidebar_position:3},i="Comment lancer un calcul sur Turpan ?",s={unversionedId:"arch_exp/turpan/soumettre_calcul/index",id:"arch_exp/turpan/soumettre_calcul/index",title:"Lancer un calcul",description:"L'utilisateur peut ex\xe9cuter un maximum de 3 jobs simultan\xe9ment, quelle que soit la partition utilis\xe9e. Dans tous les cas, il est imp\xe9ratif de respecter les contraintes sp\xe9cifiques de chaque partition, comme indiqu\xe9 ci-dessous :",source:"@site/docs/arch_exp/turpan/soumettre_calcul/index.md",sourceDirName:"arch_exp/turpan/soumettre_calcul",slug:"/arch_exp/turpan/soumettre_calcul/",permalink:"/documentation/user-documentation/arch_exp/turpan/soumettre_calcul/",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Lancer un calcul",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Transfert des fichiers",permalink:"/documentation/user-documentation/arch_exp/turpan/connexion/transfert"},next:{title:"MIG",permalink:"/documentation/user-documentation/arch_exp/turpan/soumettre_calcul/MIG"}},c={},p=[{value:"Comment lancer un script <code>sbatch</code> ?",id:"comment-lancer-un-script-sbatch-",level:2},{value:"Obtenir des informations sur un job",id:"obtenir-des-informations-sur-un-job",level:2}],m={toc:p},d="wrapper";function b(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"comment-lancer-un-calcul-sur-turpan-"},"Comment lancer un calcul sur Turpan ?"),(0,r.kt)("p",null,"L'utilisateur peut ex\xe9cuter un maximum de 3 jobs simultan\xe9ment, quelle que soit la partition utilis\xe9e. Dans tous les cas, il est imp\xe9ratif de respecter les contraintes sp\xe9cifiques de chaque partition, comme indiqu\xe9 ci-dessous :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"small")," : exclusive, 2 jobs max, pas plus de 6 noeuds par jobs, max walltime par job 4H."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"big")," : exclusive, 1 job max, pas plus de 13 noeuds par jobs, max walltime par job 2H."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"full")," : exclusive, 1 job max, au moins 14 noeuds par jobs, max walltime par job 20H"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"visu")," : non exclusive, 1 job max, max 50Go RAM max 8 cpu par job, max walltime par job 4H."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"shared")," : non exclusive, 2 jobs max, max la moiti\xe9 du noeud (40 cpu et max 256G ram,1 GPU ), max walltime par job 4H.")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Exclusive"),": Un job en partition exclusive r\xe9serve l\u2019int\xe9gralit\xe9 des n\u0153uds qui lui sont attribu\xe9s."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Non exclusive"),": Un job en partition non exclusive ne r\xe9serve pas l\u2019int\xe9gralit\xe9 du n\u0153ud, ce qui permet \xe0 d\u2019un autre job (d\u2019un autre utilisateur) de partager les m\xeames ressources.")),(0,r.kt)("p",{parentName:"admonition"},"Le choix de la partition d\xe9pend des besoins en ressources, notamment en termes de nombre de c\u0153urs par n\u0153ud et des limites de temps de calcul (walltime), veuillez consulter ",(0,r.kt)("a",{parentName:"p",href:"/documentation/user-documentation/arch_exp/turpan/accounting/accounting-rules#exemples-"},"les r\xe8gles de comptabilisation des ressources "),".")),(0,r.kt)("p",null,"Afin de ne pas monopoliser l\u2019ensemble des noeuds du cluster en journ\xe9e :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'la partition "full" est activ\xe9e du lundi au vendredi \xe0 18H00'),(0,r.kt)("li",{parentName:"ul"},'la partition "full" est d\xe9sactiv\xe9e du lundi au jeudi ainsi que le dimanche \xe0 partir de 22H00')),(0,r.kt)("p",null,'Lorsque la partition est d\xe9sactiv\xe9e, les soumissions sont possibles, mais les jobs sont suspendus jusqu\u2019\xe0 l\u2019activation de la partition. A la d\xe9sactivation, les jobs RUNNING sur la partition "full" ne sont pas arr\xeat\xe9s.'),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Si votre application n\u2019utilise qu\u2019un seul GPU et ne consomme pas toute la capacit\xe9 du GPU, pensez \xe0 v\xe9rifier l\u2019option ",(0,r.kt)("a",{parentName:"p",href:"/documentation/user-documentation/arch_exp/turpan/soumettre_calcul/MIG"},(0,r.kt)("strong",{parentName:"a"},"MIG")),".")),(0,r.kt)("h2",{id:"comment-lancer-un-script-sbatch-"},"Comment lancer un script ",(0,r.kt)("inlineCode",{parentName:"h2"},"sbatch")," ?"),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(u.Z,{label:"Exemple script exclusif",value:"exclusif",default:!0,mdxType:"TabItem"},(0,r.kt)("p",null,"Exemple script exclusif, 2 n\u0153uds, 160 processeurs, le temps d'ex\xe9cution moins de 4H"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"#!/bin/bash\n#SBATCH -N 2\n#SBATCH -n 160\n#SBATCH --gres=gpu:2 \n#SBATCH -p small\n#SBATCH --ntasks-per-node=80\n#SBATCH --time=00:10:00\n\nmodule purge\nmodule load gnu/11.2.0\nmodule load openmpi/gnu/4.1.4-gpu\n\nnodeset -e ${SLURM_JOB_NODELIST} | tr ' ' '\\n' > hostfile_${SLURM_JOBID}\nmpirun -hostfile ./hostfile_${SLURM_JOBID} -n 160 ./exec\n")))),(0,r.kt)(u.Z,{label:"Exemple script shared",value:"shared",mdxType:"TabItem"},(0,r.kt)("p",null,"Exemple script shared, 1 n\u0153ud, 40 processeurs,  le temps d'ex\xe9cution moins de 4H"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"#!/bin/bash\n#SBATCH -N 1\n#SBATCH -n 40\n#SBATCH --gres=gpu:1\n#SBATCH -p shared\n#SBATCH --ntasks-per-node=40\n#SBATCH --time=00:10:00\n#SBATCH --mem=256G     # M\xe9moire par d\xe9faut est 64G, max est 256 G \n\nmodule purge\nmodule load gnu/11.2.0\nmodule load openmpi/gnu/4.1.4-gpu\n\nmpirun -n 40 ./exec\n"))))),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Sur la partition ",(0,r.kt)("strong",{parentName:"p"},"shared"),", la m\xe9moire par d\xe9faut est de 64G, mais vous pouvez l'augmenter jusqu'\xe0 256 G en utilisant ",(0,r.kt)("inlineCode",{parentName:"p"},"#SBATCH --mem")," .\nSi ",(0,r.kt)("inlineCode",{parentName:"p"},"#SBATCH --mem")," n'est pas pr\xe9sent dans votre script, la m\xe9moire attribu\xe9 \xe0 la t\xe2che est de 64 Go par d\xe9faut.")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Sur Turpan, si l'application utilise ",(0,r.kt)("strong",{parentName:"p"},"MPI"),", il est n\xe9cessaire d'utiliser ",(0,r.kt)("strong",{parentName:"p"},"mpirun")," et d'\xe9viter srun, sauf si un conteneur est utilis\xe9 (",(0,r.kt)("a",{parentName:"p",href:"/documentation/user-documentation/arch_exp/turpan/logiciels/container/"},"voir ici"),"). Pour les autres applications ",(0,r.kt)("strong",{parentName:"p"},"sans MPI"),", srun reste valide")),(0,r.kt)("h2",{id:"obtenir-des-informations-sur-un-job"},"Obtenir des informations sur un job"),(0,r.kt)("p",null,"Il est possible pour visualiser simplement des information sur son job d'utiliser la commande ",(0,r.kt)("inlineCode",{parentName:"p"},"jobinfo <jobid>"),".Il peut \xeatre utilis\xe9 \xe0 la fin d'un script sbatch, jobinfo donnera des informations tr\xe8s utiles si vous contactez le support."),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(u.Z,{label:"Normal",value:"simple-info",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"jobinfo 6101\n")),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre"},"Job Infos :\n               Name : Test partition small - 4 noeuds\n               User : marteau\n          Partition : small\n             NNodes : 4\n              Nodes : turpancomp[0-3]\n              State : COMPLETED\n             Submit : 2023-04-14T16:08:02\n              Start : 2023-04-14T16:08:02\n                End : 2023-04-14T16:08:05\n  Reserved walltime : 04:00:00\n      Used walltime : 00:00:03\n      Used CPU time : 00:01.884\n% User Computation) : 0 % (00:00.658)\n     % System (I/O) : 100.00 % (00:01.225)\n       Mem reserved : 2.0T\n       Max Mem used : 24M\n     Max Disk Write : 0\n      Max Disk Read : 0\n Energy consumption : 1W.h\n")))),(0,r.kt)(u.Z,{label:"Debug / Support",value:"support-info",mdxType:"TabItem"},(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre"},'#!/bin/bash\n#SBATCH -N 2\n#SBATCH -n 160\n#SBATCH --gres=gpu:2 \n#SBATCH -p small\n#SBATCH --ntasks-per-node=80\n#SBATCH --time=00:10:00\n\n# Chargement des modules\nmodule purge\nmodule load gnu/11.2.0\nmodule load openmpi/gnu/4.1.4-gpu\n\n# Preparation de l\'environnement d\'execution\nmyProjectDir=/users/sysadmin/marteau/slurm-scripts/mpi_hello_world_project\nmyExec="mpi_hello_world"\nmyWorkDir="${SLURM_JOBID}"\nmkdir -p "${myWorkDir}"\ncd "${myWorkDir}"\ncp "${0}" .\ncp ${myProjectDir}/${myExec} .\n\nnodeset -e "${SLURM_JOB_NODELIST}" | tr \' \' \'\\n\' > "hostfile_${SLURM_JOBID}"\nmpirun -hostfile "./hostfile_${SLURM_JOBID}" -n 160 "./${myExec}"\n\njobinfo "${SLURM_JOBID}"\n'))),(0,r.kt)("p",null,"Ce qui affiche dans la sortie slurm (",(0,r.kt)("inlineCode",{parentName:"p"},"slurm-<jobid>.out"),"):"),(0,r.kt)("blockquote",null,(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre"},"[...]\nJob Infos :\n               Name : partition-small-jobinfo.sbatch\n               User : marteau\n          Partition : small\n             NNodes : 2\n              Nodes : turpancomp[0-1]\n              State : RUNNING\n             Submit : 2023-04-17T17:58:37\n              Start : 2023-04-17T17:58:37\n                End : Unknown\n  Reserved walltime : 00:10:00\n      Used walltime : 00:01:04\n      Used CPU time : 00:46.488\n% User Computation) : 41.00 % (00:19.439)\n     % System (I/O) : 58.00 % (00:27.049)\n       Mem reserved : 1008G\n       Max Mem used : 9.8G\n     Max Disk Write : 329M\n      Max Disk Read : 250M\n Energy consumption : 3W.h\n\nDebug Infos :\n          BatchHost : turpancomp0\n            Command : /users/sysadmin/marteau/slurm-scripts/partition-small-jobinfo.sbatch\n             StdOut : /tmpdir/marteau/slurm-6154.out\n             StdErr : /tmpdir/marteau/slurm-6154.out\n            WorkDir : /tmpdir/marteau\n"))))),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Il peut \xeatre utile de mettre une petite temporisation avant la commande jobinfo pour permettre d'avoir les derni\xe8res valeurs de l'accounting slurm s'il est utilis\xe9 dans un script sbatch."),(0,r.kt)("blockquote",{parentName:"admonition"},(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre"},"sleep 10\njobinfo\n")))))}b.isMDXComponent=!0}}]);