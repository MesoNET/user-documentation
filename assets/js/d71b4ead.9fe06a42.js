"use strict";(self.webpackChunkmesodocs=self.webpackChunkmesodocs||[]).push([[7622],{4137:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=r.createContext({}),s=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=s(e.components);return r.createElement(i.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,i=e.parentName,c=u(e,["components","mdxType","originalType","parentName"]),p=s(n),m=a,f=p["".concat(i,".").concat(m)]||p[m]||d[m]||l;return n?r.createElement(f,o(o({ref:t},c),{},{components:n})):r.createElement(f,o({ref:t},c))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,o=new Array(l);o[0]=m;var u={};for(var i in t)hasOwnProperty.call(t,i)&&(u[i]=t[i]);u.originalType=e,u[p]="string"==typeof e?e:a,o[1]=u;for(var s=2;s<l;s++)o[s]=n[s];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},425:(e,t,n)=>{n.d(t,{Z:()=>o});var r=n(7294),a=n(6010);const l={tabItem:"tabItem_Ymn6"};function o(e){let{children:t,hidden:n,className:o}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(l.tabItem,o),hidden:n},t)}},3992:(e,t,n)=>{n.d(t,{Z:()=>N});var r=n(7462),a=n(7294),l=n(6010),o=n(2957),u=n(6550),i=n(5238),s=n(3609),c=n(2560);function p(e){return function(e){return a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:a}}=e;return{value:t,label:n,attributes:r,default:a}}))}function d(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,s.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:n}=e;const r=(0,u.k6)(),l=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,i._X)(l),(0,a.useCallback)((e=>{if(!l)return;const t=new URLSearchParams(r.location.search);t.set(l,e),r.replace({...r.location,search:t.toString()})}),[l,r])]}function b(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,l=d(e),[o,u]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:l}))),[i,s]=f({queryString:n,groupId:r}),[p,b]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,l]=(0,c.Nk)(n);return[r,(0,a.useCallback)((e=>{n&&l.set(e)}),[n,l])]}({groupId:r}),h=(()=>{const e=i??p;return m({value:e,tabValues:l})?e:null})();(0,a.useLayoutEffect)((()=>{h&&u(h)}),[h]);return{selectedValue:o,selectValue:(0,a.useCallback)((e=>{if(!m({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);u(e),s(e),b(e)}),[s,b,l]),tabValues:l}}var h=n(1048);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function k(e){let{className:t,block:n,selectedValue:u,selectValue:i,tabValues:s}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,o.o5)(),d=e=>{const t=e.currentTarget,n=c.indexOf(t),r=s[n].value;r!==u&&(p(t),i(r))},m=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":n},t)},s.map((e=>{let{value:t,label:n,attributes:o}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:u===t?0:-1,"aria-selected":u===t,key:t,ref:e=>c.push(e),onKeyDown:m,onClick:d},o,{className:(0,l.Z)("tabs__item",v.tabItem,o?.className,{"tabs__item--active":u===t})}),n??t)})))}function g(e){let{lazy:t,children:n,selectedValue:r}=e;const l=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=l.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},l.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function y(e){const t=b(e);return a.createElement("div",{className:(0,l.Z)("tabs-container",v.tabList)},a.createElement(k,(0,r.Z)({},e,t)),a.createElement(g,(0,r.Z)({},e,t)))}function N(e){const t=(0,h.Z)();return a.createElement(y,(0,r.Z)({key:String(t)},e))}},2144:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>f,frontMatter:()=>u,metadata:()=>s,toc:()=>p});var r=n(7462),a=(n(7294),n(4137)),l=n(3992),o=n(425);const u={title:"Les conteneurs",sidebar_position:12},i=void 0,s={unversionedId:"arch_exp/turpan/logiciels/apptainer",id:"arch_exp/turpan/logiciels/apptainer",title:"Les conteneurs",description:"Vous pouvez d\xe9ployer vos applications via des conteneurs Apptainer (anciennement Singularity)",source:"@site/docs/arch_exp/turpan/logiciels/apptainer.md",sourceDirName:"arch_exp/turpan/logiciels",slug:"/arch_exp/turpan/logiciels/apptainer",permalink:"/documentation/user-documentation/arch_exp/turpan/logiciels/apptainer",draft:!1,tags:[],version:"current",sidebarPosition:12,frontMatter:{title:"Les conteneurs",sidebar_position:12},sidebar:"tutorialSidebar",previous:{title:"Tensorboard",permalink:"/documentation/user-documentation/arch_exp/turpan/logiciels/envpython/tensorboard"},next:{title:"Am\xe9liorer les performances",permalink:"/documentation/user-documentation/arch_exp/turpan/performance/"}},c={},p=[{value:"Construction de conteneurs",id:"construction-de-conteneurs",level:2},{value:"Utilisation d&#39;un conteneur Apptainer",id:"utilisation-dun-conteneur-apptainer",level:2},{value:"T\xe9l\xe9chargement de conteneurs depuis un d\xe9p\xf4t",id:"t\xe9l\xe9chargement-de-conteneurs-depuis-un-d\xe9p\xf4t",level:2},{value:"Gestion du cache local",id:"gestion-du-cache-local",level:2},{value:"Pour aller plus loin",id:"pour-aller-plus-loin",level:2}],d={toc:p},m="wrapper";function f(e){let{components:t,...n}=e;return(0,a.kt)(m,(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Vous pouvez d\xe9ployer vos applications via des conteneurs Apptainer (anciennement Singularity)"),(0,a.kt)("h2",{id:"construction-de-conteneurs"},"Construction de conteneurs"),(0,a.kt)("p",null,"Pour vous permettre de cr\xe9er facilement des conteneurs pour l'architecture des CPUs ARM, la construction de conteneurs apptainer sur Turpan est possible \xe0 partir des frontales de connexion \xe0 l'aide de la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"apptainer build")),(0,a.kt)("h2",{id:"utilisation-dun-conteneur-apptainer"},"Utilisation d'un conteneur Apptainer"),(0,a.kt)("p",null,"Pour \xeatre utilisables, les conteneurs doivent obligatoirement se trouver dans un sous-r\xe9pertoire de ",(0,a.kt)("inlineCode",{parentName:"p"},"/work/conteneurs"),". Vous devez contacter le support et demander la cr\xe9ation d'un dossier pour votre compte s'il n'existe pas."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Merci de r\xe9server le lancement de conteneurs sur la frontale de connexion \xe0 des tests uniquement (shell interactif, installations de paquets python, etc...)")),(0,a.kt)(l.Z,{mdxType:"Tabs"},(0,a.kt)(o.Z,{label:"Mode sbatch",value:"sbatch",default:!0,mdxType:"TabItem"},"Pour utiliser un conteneur depuis un script sbatch:",(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Pour ex\xe9cuter un conteneur qui ex\xe9cute un code sp\xe9cifique :"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"apptainer run /work/conteneurs/${PROJET}/${USER}/mon_conteneur.sif\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Pour ex\xe9cuter mon code \xe0 qui se trouve \xe0 l'int\xe9rieur du conteneur :"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"apptainer exec --nv /work/conteneurs/${PROJET}/${USER}/mon_conteneur.sif python mon_script.py\n"))))),(0,a.kt)(o.Z,{label:"Mode interractif",value:"interractif",default:!0,mdxType:"TabItem"},(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Depuis une frontale, pour faire des essais ou des installations particuli\xe8res :"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"apptainer shell /work/conteneurs/<projet>/<user>/mon_conteneur.sif\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Dans une r\xe9servation interractive avec salloc ou srun, vous pouvez ex\xe9cuter un conteneur pour appeler un shell dans le conteneur :"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"srun -n 1 -p shared --pty apptainer shell /work/conteneurs/<projet>/<user>/mon_conteneur.sif\n")))))),(0,a.kt)("p",null,"Par d\xe9faut, seul votre espace HOME est accessible \xe0 l'int\xe9rieur du conteneur. Pour ajouter les espaces WORK et TMPDIR vous devez ajouter l'option suivante : "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"--bind /tmpdir,/work\n")),(0,a.kt)("h2",{id:"t\xe9l\xe9chargement-de-conteneurs-depuis-un-d\xe9p\xf4t"},"T\xe9l\xe9chargement de conteneurs depuis un d\xe9p\xf4t"),(0,a.kt)("p",null,"Vous pouvez utiliser des conteneurs mis \xe0 disposition par des \xe9diteurs ou des projets de d\xe9veloppement  \xe0 l'aide de la commande apptainer pull"),(0,a.kt)("p",null,"Par exemple :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Ajout du d\xe9pot Sylabs",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"apptainer remote add --no-login SylabsCloud cloud.sycloud.io\napptainer remote use SylabsCloud\n"))),(0,a.kt)("li",{parentName:"ul"},"T\xe9l\xe9chargement d'un conteneur de test",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"cd /work/conteneurs/${PROJET}/${USER}\napptainer pull --arch arm64 library://library/default/lolcow:latest\n")))),(0,a.kt)("p",null,"Pour tester :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"apptainer run /work/conteneurs/${PROJET}/${USER}/lolcow_latest.sif\n")),(0,a.kt)("h2",{id:"gestion-du-cache-local"},"Gestion du cache local"),(0,a.kt)("p",null,"Attention, des fichiers de cache parfois volumineux sont t\xe9l\xe9charg\xe9s localement dans votre espace $HOME  lorsque vous utilisez la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"apptainer pull"),"."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Pour lister le contenu du cache et l'espace utilis\xe9 : ",(0,a.kt)("inlineCode",{parentName:"li"},"apptainer cache list")),(0,a.kt)("li",{parentName:"ul"},"Pour vider le cache et lib\xe9rer l'espace : ",(0,a.kt)("inlineCode",{parentName:"li"},"apptainer cache clean"))),(0,a.kt)("h2",{id:"pour-aller-plus-loin"},"Pour aller plus loin"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://apptainer.org/docs/user/1.1/"},"La documentation officielle du logiciel Apptainer")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Pour des raisons de s\xe9curit\xe9, l'ex\xe9cution de conteneurs en mode privil\xe9gi\xe9 (setuid) n'est pas autoris\xe9e sur Turpan. Dans de rares cas, cela peut emp\xeacher l'utilisation de certaines options d'Apptainer")))}f.isMDXComponent=!0}}]);