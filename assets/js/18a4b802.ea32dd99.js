"use strict";(self.webpackChunkmesodocs=self.webpackChunkmesodocs||[]).push([[5537],{4137:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),s=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):u(u({},t),e)),n},c=function(e){var t=s(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=s(n),m=a,f=p["".concat(l,".").concat(m)]||p[m]||d[m]||o;return n?r.createElement(f,u(u({ref:t},c),{},{components:n})):r.createElement(f,u({ref:t},c))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,u=new Array(o);u[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[p]="string"==typeof e?e:a,u[1]=i;for(var s=2;s<o;s++)u[s]=n[s];return r.createElement.apply(null,u)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},425:(e,t,n)=>{n.d(t,{Z:()=>u});var r=n(7294),a=n(6010);const o={tabItem:"tabItem_Ymn6"};function u(e){let{children:t,hidden:n,className:u}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(o.tabItem,u),hidden:n},t)}},3992:(e,t,n)=>{n.d(t,{Z:()=>T});var r=n(7462),a=n(7294),o=n(6010),u=n(2957),i=n(6550),l=n(5238),s=n(3609),c=n(2560);function p(e){return function(e){return a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:a}}=e;return{value:t,label:n,attributes:r,default:a}}))}function d(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,s.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:n}=e;const r=(0,i.k6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._X)(o),(0,a.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(r.location.search);t.set(o,e),r.replace({...r.location,search:t.toString()})}),[o,r])]}function b(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,o=d(e),[u,i]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:o}))),[l,s]=f({queryString:n,groupId:r}),[p,b]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,o]=(0,c.Nk)(n);return[r,(0,a.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:r}),v=(()=>{const e=l??p;return m({value:e,tabValues:o})?e:null})();(0,a.useLayoutEffect)((()=>{v&&i(v)}),[v]);return{selectedValue:u,selectValue:(0,a.useCallback)((e=>{if(!m({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);i(e),s(e),b(e)}),[s,b,o]),tabValues:o}}var v=n(1048);const h={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function y(e){let{className:t,block:n,selectedValue:i,selectValue:l,tabValues:s}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,u.o5)(),d=e=>{const t=e.currentTarget,n=c.indexOf(t),r=s[n].value;r!==i&&(p(t),l(r))},m=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t)},s.map((e=>{let{value:t,label:n,attributes:u}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:e=>c.push(e),onKeyDown:m,onClick:d},u,{className:(0,o.Z)("tabs__item",h.tabItem,u?.className,{"tabs__item--active":i===t})}),n??t)})))}function k(e){let{lazy:t,children:n,selectedValue:r}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},o.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function g(e){const t=b(e);return a.createElement("div",{className:(0,o.Z)("tabs-container",h.tabList)},a.createElement(y,(0,r.Z)({},e,t)),a.createElement(k,(0,r.Z)({},e,t)))}function T(e){const t=(0,v.Z)();return a.createElement(g,(0,r.Z)({key:String(t)},e))}},3903:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>f,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=n(7462),a=(n(7294),n(4137)),o=n(3992),u=n(425);const i={title:"Modulus",sidebar_position:7},l=void 0,s={unversionedId:"arch_exp/turpan/logiciels/envpython/modulus",id:"arch_exp/turpan/logiciels/envpython/modulus",title:"Modulus",description:"L'installation de Modulus par pip ou conda sur l'architecture ARM (aarch64) installe uniquement une version CPU. Pour permettre une utilisation GPU, nous avons cr\xe9\xe9 un conteneur apptainer en adaptant pour TURPAN le conteneur Modulus de Nvidia. Il contient l'ensemble des programmes et librairies d\xe9crit ici//docs.nvidia.com/modulus/index.html",source:"@site/docs/arch_exp/turpan/logiciels/envpython/modulus.md",sourceDirName:"arch_exp/turpan/logiciels/envpython",slug:"/arch_exp/turpan/logiciels/envpython/modulus",permalink:"/documentation/user-documentation/arch_exp/turpan/logiciels/envpython/modulus",draft:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{title:"Modulus",sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"Scikit-learn et rapids",permalink:"/documentation/user-documentation/arch_exp/turpan/logiciels/envpython/scikit-learn"},next:{title:"Notebook jupyter",permalink:"/documentation/user-documentation/arch_exp/turpan/logiciels/envpython/jupyterlab"}},c={},p=[{value:"Utilisation du conteneur modulus",id:"utilisation-du-conteneur-modulus",level:2},{value:"Pour plus d&#39;information",id:"pour-plus-dinformation",level:2},{value:"Conteneur rapids et modules python suppl\xe9mentaires",id:"conteneur-rapids-et-modules-python-suppl\xe9mentaires",level:2}],d={toc:p},m="wrapper";function f(e){let{components:t,...n}=e;return(0,a.kt)(m,(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"L'installation de Modulus par pip ou conda sur l'architecture ARM (aarch64) installe uniquement une version CPU. Pour permettre une utilisation GPU, nous avons cr\xe9\xe9 un conteneur apptainer en adaptant pour TURPAN le conteneur Modulus de Nvidia. Il contient l'ensemble des programmes et librairies d\xe9crit ici : ",(0,a.kt)("a",{parentName:"p",href:"https://docs.nvidia.com/modulus/index.html"},"https://docs.nvidia.com/modulus/index.html")),(0,a.kt)("h2",{id:"utilisation-du-conteneur-modulus"},"Utilisation du conteneur modulus"),(0,a.kt)("p",null,"Il y a deux fa\xe7ons d'utiliser ce conteneur :"),(0,a.kt)(o.Z,{mdxType:"Tabs"},(0,a.kt)(u.Z,{label:"Mode sbatch",value:"sbatch",default:!0,mdxType:"TabItem"},(0,a.kt)("p",null,"Vous pouvez utiliser le conteneur dans un script sbatch. Dans l'exemple ci-dessous avec une r\xe9servation de 1 c\u0153ur CPU et 1 GPU :"),(0,a.kt)("blockquote",null,(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre"},"#!/bin/bash\n#SBATCH -J mon_job\n#SBATCH -p shared\n#SBATCH --nodes 1\n#SBATCH --ntasks 1\n#SBATCH --time=0:15:00\n#SBATCH --gres=gpu:1\n\napptainer exec --bind /tmpdir,/work --nv /work/conteneurs/sessions-interactives/modulus-24.01-calmip-si.sif python mon_script.py\n")))),(0,a.kt)(u.Z,{label:"Mode interractif",value:"interractif",default:!0,mdxType:"TabItem"},(0,a.kt)("p",null,"Vous pouvez utiliser le conteneur interactif (pour tester ou installer d'autres outils ou configurer votre environnement). Dans l'exemple ci-dessous avec une demande de ressources de 1 c\u0153ur CPU et 1 GPU :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'srun -p shared -n1 --gres=gpu:1 --pty apptainer shell --nv /work/conteneurs/sessions-interactives/modulus-24.01-calmip-si.sif\nApptainer> python\nPython 3.10.12 (main, Jun 11 2023, 05:26:28) [GCC 11.4.0] on linux\nType "help", "copyright", "credits" or "license" for more information.\n>>> import torch\n>>> from modulus.models.mlp.fully_connected import FullyConnected\n>>> model = FullyConnected(in_features=32, out_features=64)\n>>> input = torch.randn(128, 32)\n>>> output = model(input)\n>>> output.shape\ntorch.Size([128, 64])\n[...]\n>>> # Vos commandes python\n[...]\n')))),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Le conteneur n'a acc\xe8s par d\xe9faut qu'\xe0 votre espace $HOME. Si vous avez besoin des espaces WORK ",(0,a.kt)("inlineCode",{parentName:"p"},"/work")," ou SCRATCH ",(0,a.kt)("inlineCode",{parentName:"p"},"/tmpdir")," vous pouvez les accrocher en utilisant l'option ",(0,a.kt)("inlineCode",{parentName:"p"},"--bind")," d'Apptainer par exemple :"),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"apptainer exec --bind /tmpdir,/work --nv ...\n"))),(0,a.kt)("h2",{id:"pour-plus-dinformation"},"Pour plus d'information"),(0,a.kt)("p",null,"Pour plus d'information sur l'utilisation des conteneurs Apptainer :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"La documentation de l'",(0,a.kt)("a",{parentName:"li",href:"/documentation/user-documentation/arch_exp/turpan/logiciels/apptainer"},"utilisation des conteneurs Apptainer sur Turpan")),(0,a.kt)("li",{parentName:"ul"},"La documentation officeille d'Apptainer : ",(0,a.kt)("a",{parentName:"li",href:"https://apptainer.org/docs/user/1.1/"},"https://apptainer.org/docs/user/1.1/"))),(0,a.kt)("h2",{id:"conteneur-rapids-et-modules-python-suppl\xe9mentaires"},"Conteneur rapids et modules python suppl\xe9mentaires"),(0,a.kt)("p",null,"Utilisez la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"conda env list")," pour trouver le chemin de votre environnement Conda"),(0,a.kt)("blockquote",null,(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre"},"$ conda env list \n# conda environments:\nmyenv3                 /users/sysadmin/user_name/.conda/envs/myenv3\nbase                   /usr/local/miniconda/25.1.1\npython-3.10.9          /usr/local/miniconda/25.1.1/envs/python-3.10.9\npython-tools-3.10.9    /usr/local/miniconda/25.1.1/envs/python-tools-3.10.9\n"))),(0,a.kt)("p",null,"Le chemin sera ensuite utilis\xe9 pour l\u2019ajouter au conteneur Apptainer, comme montr\xe9 dans le script suivant."),(0,a.kt)("blockquote",null,(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre"},"#!/bin/bash\n#SBATCH -J mon_job\n#SBATCH -p shared\n#SBATCH --nodes 1\n#SBATCH --ntasks 1\n#SBATCH --time=0:15:00\n#SBATCH --gres=gpu:1\n\nENV_PATH=/tmpdir/user_name/.conda/envs/myenv3\n\napptainer exec \\\n --nv \\\n --bind /tmpdir,/work \\\n --env PYTHONUSERBASE=$ENV_PATH \\\n --env LD_LIBRARY_PATH=$ENV_PATH/lib:$LD_LIBRARY_PATH \\\n /work/conteneurs/sessions-interactives/modulus-24.01-calmip-si.sif \\\n python mon_script.py\n"))))}f.isMDXComponent=!0}}]);