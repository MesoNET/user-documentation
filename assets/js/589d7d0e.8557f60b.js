"use strict";(self.webpackChunkmesodocs=self.webpackChunkmesodocs||[]).push([[5047],{4137:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>k});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),u=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=u(e.components);return r.createElement(l.Provider,{value:n},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(t),d=a,k=c["".concat(l,".").concat(d)]||c[d]||m[d]||o;return t?r.createElement(k,i(i({ref:n},p),{},{components:t})):r.createElement(k,i({ref:n},p))}));function k(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[c]="string"==typeof e?e:a,i[1]=s;for(var u=2;u<o;u++)i[u]=t[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},425:(e,n,t)=>{t.d(n,{Z:()=>i});var r=t(7294),a=t(6010);const o={tabItem:"tabItem_Ymn6"};function i(e){let{children:n,hidden:t,className:i}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(o.tabItem,i),hidden:t},n)}},3992:(e,n,t)=>{t.d(n,{Z:()=>g});var r=t(7462),a=t(7294),o=t(6010),i=t(2957),s=t(6550),l=t(5238),u=t(3609),p=t(2560);function c(e){return function(e){return a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:a}}=e;return{value:n,label:t,attributes:r,default:a}}))}function m(e){const{values:n,children:t}=e;return(0,a.useMemo)((()=>{const e=n??c(t);return function(e){const n=(0,u.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function d(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function k(e){let{queryString:n=!1,groupId:t}=e;const r=(0,s.k6)(),o=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,l._X)(o),(0,a.useCallback)((e=>{if(!o)return;const n=new URLSearchParams(r.location.search);n.set(o,e),r.replace({...r.location,search:n.toString()})}),[o,r])]}function v(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,o=m(e),[i,s]=(0,a.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!d({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:o}))),[l,u]=k({queryString:t,groupId:r}),[c,v]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[r,o]=(0,p.Nk)(t);return[r,(0,a.useCallback)((e=>{t&&o.set(e)}),[t,o])]}({groupId:r}),h=(()=>{const e=l??c;return d({value:e,tabValues:o})?e:null})();(0,a.useLayoutEffect)((()=>{h&&s(h)}),[h]);return{selectedValue:i,selectValue:(0,a.useCallback)((e=>{if(!d({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);s(e),u(e),v(e)}),[u,v,o]),tabValues:o}}var h=t(1048);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function y(e){let{className:n,block:t,selectedValue:s,selectValue:l,tabValues:u}=e;const p=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.o5)(),m=e=>{const n=e.currentTarget,t=p.indexOf(n),r=u[t].value;r!==s&&(c(n),l(r))},d=e=>{let n=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const t=p.indexOf(e.currentTarget)+1;n=p[t]??p[0];break}case"ArrowLeft":{const t=p.indexOf(e.currentTarget)-1;n=p[t]??p[p.length-1];break}}n?.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":t},n)},u.map((e=>{let{value:n,label:t,attributes:i}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,key:n,ref:e=>p.push(e),onKeyDown:d,onClick:m},i,{className:(0,o.Z)("tabs__item",b.tabItem,i?.className,{"tabs__item--active":s===n})}),t??n)})))}function f(e){let{lazy:n,children:t,selectedValue:r}=e;const o=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},o.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==r}))))}function N(e){const n=v(e);return a.createElement("div",{className:(0,o.Z)("tabs-container",b.tabList)},a.createElement(y,(0,r.Z)({},e,n)),a.createElement(f,(0,r.Z)({},e,n)))}function g(e){const n=(0,h.Z)();return a.createElement(N,(0,r.Z)({key:String(n)},e))}},6022:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>k,frontMatter:()=>s,metadata:()=>u,toc:()=>c});var r=t(7462),a=(t(7294),t(4137)),o=t(3992),i=t(425);const s={title:"Notebook jupyter",sidebar_position:8},l=void 0,u={unversionedId:"arch_exp/turpan/logiciels/envpython/jupyterlab",id:"arch_exp/turpan/logiciels/envpython/jupyterlab",title:"Notebook jupyter",description:"Durant la phase mise au point des scripts python, il peut \xeatre int\xe9ressant d\u2019utiliser l\u2019outil jupyter notebook.",source:"@site/docs/arch_exp/turpan/logiciels/envpython/jupyterlab.md",sourceDirName:"arch_exp/turpan/logiciels/envpython",slug:"/arch_exp/turpan/logiciels/envpython/jupyterlab",permalink:"/documentation/user-documentation/arch_exp/turpan/logiciels/envpython/jupyterlab",draft:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"Notebook jupyter",sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"Modulus",permalink:"/documentation/user-documentation/arch_exp/turpan/logiciels/envpython/modulus"},next:{title:"Tensorboard",permalink:"/documentation/user-documentation/arch_exp/turpan/logiciels/envpython/tensorboard"}},p={},c=[{value:"Comment demander une session interactive de notebook jupyter",id:"comment-demander-une-session-interactive-de-notebook-jupyter",level:2},{value:"Utiliser les conteneurs nvidia (pytorch, tensorflow, rapids, modulus et triton)",id:"utiliser-les-conteneurs-nvidia-pytorch-tensorflow-rapids-modulus-et-triton",level:2},{value:"Utiliser un conteneurs custom",id:"utiliser-un-conteneurs-custom",level:3},{value:"Exemple de build issue de la version 24.10 du conteneur pytorch :",id:"exemple-de-build-issue-de-la-version-2410-du-conteneur-pytorch-",level:4},{value:"Pour utiliser le conteneur custom",id:"pour-utiliser-le-conteneur-custom",level:4},{value:"Installer un paquet python suppl\xe9mentaire dans mon environnement",id:"installer-un-paquet-python-suppl\xe9mentaire-dans-mon-environnement",level:3},{value:"Pour tester",id:"pour-tester",level:3},{value:"Passer en production",id:"passer-en-production",level:3},{value:"Comment arr\xeater une session interactive de notebook jupyter",id:"comment-arr\xeater-une-session-interactive-de-notebook-jupyter",level:2},{value:"Si \xe7a ne fonctionne pas",id:"si-\xe7a-ne-fonctionne-pas",level:2}],m={toc:c},d="wrapper";function k(e){let{components:n,...t}=e;return(0,a.kt)(d,(0,r.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Durant la phase mise au point des scripts python, il peut \xeatre int\xe9ressant d\u2019utiliser l\u2019outil jupyter notebook."),(0,a.kt)("p",null,"C\u2019est possible sur Turpan, \xe0 certaines conditions :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"la dur\xe9e de connexion ne peut pas exc\xe9der 4 heures"),(0,a.kt)("li",{parentName:"ul"},'La r\xe9servation est sur la file "shared", et par cons\xe9quent limit\xe9e \xe0 1 GPU, 40 CPUs et 256G de RAM'),(0,a.kt)("li",{parentName:"ul"},"Pour un travail plus intensif, il vaut mieux pr\xe9f\xe9rer le lancement par sbatch qui permet de r\xe9server des ressources adapt\xe9es")),(0,a.kt)("h2",{id:"comment-demander-une-session-interactive-de-notebook-jupyter"},"Comment demander une session interactive de notebook jupyter"),(0,a.kt)("p",null,"Lorsque vous \xeates connect\xe9 sur une frontale de Turpan, ex\xe9cutez le script :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"runJupyterSession.sh\n")),(0,a.kt)("p",null,"Laissez le script d\xe9marrer (cela prend quelques secondes, soyez patient...), puis vous devriez voir un affichage de ce style :"),(0,a.kt)("blockquote",null,(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre"},"[  3/150] Queuing and waiting for Jupyter session resources initialization (JJJJJ) ...\n\njupyter session ...\n\n#===========================================================================\n|\n| Your jupyter notebook is now available. \n|  \n| You must now open a TERMINAL on YOUR laptop and execute the command : \n|\n|     ssh -L 8888:/users/mxxxxx/uyyyyy/.jupyter/jupyter-notebook-WW.XX.YY.ZZ-JJJJJ.sock  -n uyyyyy@WW.XX.YY.ZZ 'si-init.sh'\n| \n| Then from your browser, visit the following url :\n|     \n|     http://localhost:8888/?token=azertyuiopqsdfghjklmwxcvbn\n|\n#===========================================================================\n| CAUTION : DO NOT CLOSE this slurm job or this terminal !\n#===========================================================================\n\n+---------------------------------------------------------------------------\n| CONNECTION INFO :\n|   * Job ID                 : JJJJJ\n|   * Client                 : WWW.XXX.YYY.ZZZ (FROM THE MOON)\n|   * Target                 : WW.XX.YY.ZZ (turpancompY)\n|   * Notebook URL           : http://localhost:8888/?token=azertyuiopqsdfghjklmwxcvbn\n|   * Notebook token         : azertyuiopqsdfghjklmwxcvbn\n|   * SSH tunnel socket path : /users/mxxxxx/uyyyyy/.jupyter/jupyter-notebook-WW.XX.YY.ZZ-JJJJJ.sock\n+---------------------------------------------------------------------------\n\n[/] - Press CTRL-C to quit\n"))),(0,a.kt)("p",null,"Sur ",(0,a.kt)("strong",{parentName:"p"},"un second terminal")," sur ",(0,a.kt)("strong",{parentName:"p"},"votre poste de travail"),", ex\xe9cuter la commande ssh donn\xe9e par le script :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"ssh -L 8888:/users/mxxxxx/uyyyyy/.jupyter/jupyter-notebook-WW.XX.YY.ZZ-JJJJJ.sock  -n uyyyyy@WW.XX.YY.ZZ 'si-init.sh'\n")),(0,a.kt)("p",null,"Patientez l\xe0 encore quelques secondes et vous devriez obtenir le message suivant :"),(0,a.kt)("blockquote",null,(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre"},"#===========================================================================\n|\n| ssh tunnel established.\n|\n#===========================================================================\n| CAUTION : DO NOT CLOSE this terminal !\n#===========================================================================\n"))),(0,a.kt)("admonition",{title:"DO NOT CLOSE TERMINALS",type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"Comme les 2 messages l'indiquent, ne fermez pas la fen\xeatre de demande de session interactive sur Turpan, ni celle du tunnel ssh sur votre poste de travail.")),(0,a.kt)("p",null,"Enfin, vous pouvez utiliser votre notebook jupyter :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"En utilisant ",(0,a.kt)("strong",{parentName:"li"},"le navigateur de votre poste de travail"),' et copier/coller l\'URL fournie par le script "http://localhost:8888/?token=..."'),(0,a.kt)("li",{parentName:"ul"},'En utilisant vscode, et copier/coller l\'URL fournie par le script "http://localhost:8888/?token=..." en suivant la ',(0,a.kt)("a",{parentName:"li",href:"https://code.visualstudio.com/docs/datascience/jupyter-kernel-management#_existing-jupyter-server"},"documentation officielle de vscode"))),(0,a.kt)("admonition",{title:'Erreur "Permission denied (publickey)"',type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"Si vous obtenez l'erreur suivante lors de l'inititailisation du tunnel :"),(0,a.kt)("blockquote",{parentName:"admonition"},(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre"},"uyyyyy@turpanlogin.calmip.univ-toulouse.fr: Permission denied (publickey).\n"))),(0,a.kt)("p",{parentName:"admonition"},'V\xe9rifier votre configuration ssh. La configuration associ\xe9e \xe0 cl\xe9 ssh dans votre fichier .ssh/config, doit avoir "turpanlogin.calmip.univ-toulouse.fr" sur la ligne "Host" '),(0,a.kt)("blockquote",{parentName:"admonition"},(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre"},"# La configuration suivante est indispensable pour utiliser les outils\n# runVisuSession, runJupyterSession, runTensorboardSession sur turpan\nHost turpan turpanlogin turpanlogin.calmip.univ-toulouse.fr\n  Hostname turpanlogin.calmip.univ-toulouse.fr\n  IdentityFile ~/.ssh/votre_cle_ssh_privee\n  IdentitiesOnly=yes\n  User votre_nom_d_utilisateur\n")))),(0,a.kt)("h2",{id:"utiliser-les-conteneurs-nvidia-pytorch-tensorflow-rapids-modulus-et-triton"},"Utiliser les conteneurs nvidia (pytorch, tensorflow, rapids, modulus et triton)"),(0,a.kt)("p",null,"Il existe 4 type de conteneurs disponibles pour les sessions interactives :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"pytorch : ",(0,a.kt)("a",{parentName:"li",href:"https://catalog.ngc.nvidia.com/orgs/nvidia/containers/pytorch"},"NVIDIA PyTorch container")),(0,a.kt)("li",{parentName:"ul"},"tensorflow : ",(0,a.kt)("a",{parentName:"li",href:"https://catalog.ngc.nvidia.com/orgs/nvidia/containers/tensorflow"},"NVIDIA TensorFlow container")),(0,a.kt)("li",{parentName:"ul"},"rapids : ",(0,a.kt)("a",{parentName:"li",href:"https://catalog.ngc.nvidia.com/orgs/nvidia/teams/rapidsai/containers/notebooks"},"NVIDIA RAPIDS container")),(0,a.kt)("li",{parentName:"ul"},"modulus : ",(0,a.kt)("a",{parentName:"li",href:"https://catalog.ngc.nvidia.com/orgs/nvidia/teams/modulus/containers/modulus"},"NVIDIA Modulus container")),(0,a.kt)("li",{parentName:"ul"},"triton-llvm : ",(0,a.kt)("a",{parentName:"li",href:"https://triton-lang.org/main/getting-started/tutorials/index.html"},"Triton container"))),(0,a.kt)("p",null,"Ceux-ci peuvent \xeatre utilis\xe9s en invoquant ",(0,a.kt)("inlineCode",{parentName:"p"},"runJupyterSession.sh")," avec l'option ",(0,a.kt)("inlineCode",{parentName:"p"},"--container"),". Exemple pour utiliser le conteneur pytorch :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"runJupyterSession.sh --container pytorch\n")),(0,a.kt)("p",null,"Il est possible de choisir la version du conteneur \xe0 l\u2019aide de l\u2019option ",(0,a.kt)("inlineCode",{parentName:"p"},"--flavor")," :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"runJupyterSession.sh --container pytorch --flavor 24.10\n")),(0,a.kt)("p",null,"Pour consulter les versions disponibles, utilisez la commande suivante :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"runJupyterSession.sh --container pytorch --help\n")),(0,a.kt)("h3",{id:"utiliser-un-conteneurs-custom"},"Utiliser un conteneurs custom"),(0,a.kt)("p",null,"Pour utiliser un conteneur custom, il faut respecter quelques pr\xe9requis. Tout d'abord, le conteneur doit \xeatre construit depuis un des conteneurs pr\xe9d\xe9finis (ci-dessus).\nLes fichiers images (.sif) de ces conteneurs se trouvent dans le r\xe9pertoire ",(0,a.kt)("inlineCode",{parentName:"p"},"/work/conteneurs/sessions-interactives"),'. Les images valides sont celle contenant le mot cl\xe9 "latest" dans leur nom.'),(0,a.kt)("h4",{id:"exemple-de-build-issue-de-la-version-2410-du-conteneur-pytorch-"},"Exemple de build issue de la version 24.10 du conteneur pytorch :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Creation de l'environnement de build"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cd /work/conteneurs/invite/invitemc\napptainer build --sandbox mon_conteneur/ /work/conteneurs/sessions-interactives/pytorch-24.10-py3-calmip-si-latest.sif\nmkdir mon_conteneur/users  mon_conteneur/tmpdir mon_conteneur/work\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Faire les modifications que l'on souhaite au sein du conteneur"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"apptainer shell --fakeroot --bind /tmpdir,/work --writable mon_conteneur/\n")),(0,a.kt)("admonition",{parentName:"li",type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Il peut \xeatre int\xe9ressant de le faire en interractif sur un noeud pour disposer de la carte graphique"),(0,a.kt)("pre",{parentName:"admonition"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cd /work/conteneurs/invite/invitemc\nsrun -n 1 -p shared --bind /tmpdir,/work --pty apptainer shell --fakeroot --bind /tmpdir,/work --writable mon_conteneur/\n")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Cr\xe9er l'image du conteneur"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cd /work/conteneurs/invite/invitemc\napptainer build mon_conteneur.sif mon_conteneur/\napptainer cache clean\" # A faire uniquement tout a la fin une fois que l'image est d\xe9finitive pour lib\xe9rer la place\n")))),(0,a.kt)("h4",{id:"pour-utiliser-le-conteneur-custom"},"Pour utiliser le conteneur custom"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"runJupyterSession.sh --container custom --containerpath /work/conteneurs/invite/invitemc/mon_conteneur.sif\n")),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"L\u2019option ",(0,a.kt)("inlineCode",{parentName:"p"},'--pythonenvname "<envname>"')," permet d\u2019utiliser un environnement dans le conteneur. La commande suivante est ex\xe9cut\xe9 dans le conteneur avant de lancer le notebook : ",(0,a.kt)("inlineCode",{parentName:"p"},'python -m ipykernel install --user --name="<envname>"')),(0,a.kt)("p",{parentName:"admonition"},"Il est \xe9galement possible d'utiliser l'option ",(0,a.kt)("inlineCode",{parentName:"p"},"--userbase")," afin de sp\xe9cifier un chemin alternatif pour les modules ou les environnements python (",(0,a.kt)("a",{parentName:"p",href:"https://docs.python.org/3/using/cmdline.html#envvar-PYTHONUSERBASE"},"https://docs.python.org/3/using/cmdline.html#envvar-PYTHONUSERBASE"),")")),(0,a.kt)("h3",{id:"installer-un-paquet-python-suppl\xe9mentaire-dans-mon-environnement"},"Installer un paquet python suppl\xe9mentaire dans mon environnement"),(0,a.kt)("p",null,"\xc0 l'int\xe9rieur d'une cellule du notebook, ex\xe9cuter la commande ",(0,a.kt)("inlineCode",{parentName:"p"},"!pip install --user monpaquet'")),(0,a.kt)("p",null,'Exemple pour installer le paquet "ansicolors"'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"!pip install --user ansicolors\n")),(0,a.kt)("h3",{id:"pour-tester"},"Pour tester"),(0,a.kt)("p",null,"Voici des tutoriels pour tester chacun des conteneurs NVIDIA :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://pytorch.org/tutorials/beginner/basics/quickstart_tutorial.html"},"Pytoch quickstart")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://www.tensorflow.org/tutorials/quickstart/beginner"},"TensorFlow quickstart")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/rapidsai-community/notebooks-contrib/blob/main/getting_started_materials/intro_tutorials_and_guides/14_Introduction_to_Machine_Learning_using_cuML.ipynb"},"RAPIDS introduction")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://scikit-learn.org/stable/getting_started.html"},"scikit-learn Getting Started")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://docs.nvidia.com/deeplearning/modulus/getting-started/index.html"},"NVIDIA Modulus Getting Started"))),(0,a.kt)("h3",{id:"passer-en-production"},"Passer en production"),(0,a.kt)("p",null,"Une fois votre script mis au point, vous pouvez le lancer en production en mettant dans votre script sbatch les commandes suivantes. Dans cet exemple les ressources r\xe9serv\xe9es sont proches de celle de la session de Notebook Jupyter :"),(0,a.kt)(o.Z,{mdxType:"Tabs"},(0,a.kt)(i.Z,{label:"Conteneur pytorch",value:"pytorch",default:!0,mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"#!/bin/bash\n#SBATCH -N 1\n#SBATCH -n 40\n#SBATCH --gres=gpu:1\n#SBATCH -p shared\n#SBATCH --ntasks-per-node=40\n#SBATCH --time=00:10:00\n\nmodule purge\n\napptainer exec --bind /tmpdir,/work --nv /work/conteneurs/sessions-interactives/pytorch-24.02-py3-calmip-si.sif /usr/local/bin/proxychains.sh python monscript.py\n")),(0,a.kt)("p",null,'Et si vous aviez lanc\xe9 le notebook avec l\'option "--userbase" (Exemple : ',(0,a.kt)("inlineCode",{parentName:"p"},'runJupyterSession.sh --container rapids --userbase "${HOME}/myenv3"'),"), alors vous devrez ajouter ",(0,a.kt)("inlineCode",{parentName:"p"},'--env "PYTHONUSERBASE=${HOME}/myenv3"')," \xe0 la commande de lancement apptainer :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'apptainer exec --env "PYTHONUSERBASE=${HOME}/myenv3" --bind /tmpdir,/work --nv /work/conteneurs/sessions-interactives/pytorch-24.02-py3-calmip-si.sif /usr/local/bin/proxychains.sh python monscript.py\n'))),(0,a.kt)(i.Z,{label:"Conteneur tensorflow",value:"tensorflow",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"#!/bin/bash\n#SBATCH -N 1\n#SBATCH -n 40\n#SBATCH --gres=gpu:1\n#SBATCH -p shared\n#SBATCH --ntasks-per-node=40\n#SBATCH --time=00:10:00\n\nmodule purge\n\napptainer exec --bind /tmpdir,/work --nv /work/conteneurs/sessions-interactives/tensorflow-24.02-tf2-py3-calmip-si.sif /usr/local/bin/proxychains.sh python monscript.py\n")),(0,a.kt)("p",null,'Et si vous aviez lanc\xe9 le notebook avec l\'option "--userbase" (Exemple : ',(0,a.kt)("inlineCode",{parentName:"p"},'runJupyterSession.sh --container rapids --userbase "${HOME}/myenv3"'),"), alors vous devrez ajouter ",(0,a.kt)("inlineCode",{parentName:"p"},'--env "PYTHONUSERBASE=${HOME}/myenv3"')," \xe0 la commande de lancement apptainer :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'apptainer exec --env "PYTHONUSERBASE=${HOME}/myenv3" --bind /tmpdir,/work --nv /work/conteneurs/sessions-interactives/tensorflow-24.02-tf2-py3-calmip-si.sif /usr/local/bin/proxychains.sh python monscript.py\n'))),(0,a.kt)(i.Z,{label:"Conteneur rapids",value:"rapids",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"#!/bin/bash\n#SBATCH -N 1\n#SBATCH -n 40\n#SBATCH --gres=gpu:1\n#SBATCH -p shared\n#SBATCH --ntasks-per-node=40\n#SBATCH --time=00:10:00\n\nmodule purge\n\napptainer exec --bind /tmpdir,/work --nv /work/conteneurs/sessions-interactives/rapids-notebooks-24.02-cuda12.0-py3.10-si.sif /usr/local/bin/proxychains.sh python monscript.py\n")),(0,a.kt)("p",null,'Et si vous aviez lanc\xe9 le notebook avec l\'option "--userbase" (Exemple : ',(0,a.kt)("inlineCode",{parentName:"p"},'runJupyterSession.sh --container rapids --userbase "${HOME}/myenv3"'),"), alors vous devrez ajouter ",(0,a.kt)("inlineCode",{parentName:"p"},'--env "PYTHONUSERBASE=${HOME}/myenv3"')," \xe0 la commande de lancement apptainer :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'apptainer exec --env "PYTHONUSERBASE=${HOME}/myenv3" --bind /tmpdir,/work --nv /work/conteneurs/sessions-interactives/rapids-notebooks-24.02-cuda12.0-py3.10-si.sif /usr/local/bin/proxychains.sh python monscript.py\n'))),(0,a.kt)(i.Z,{label:"Conteneur modulus",value:"modulus",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"#!/bin/bash\n#SBATCH -N 1\n#SBATCH -n 40\n#SBATCH --gres=gpu:1\n#SBATCH -p shared\n#SBATCH --ntasks-per-node=40\n#SBATCH --time=00:10:00\n\nmodule purge\n\napptainer exec --bind /tmpdir,/work --nv /work/conteneurs/sessions-interactives/modulus-24.01-calmip-si.sif /usr/local/bin/proxychains.sh python monscript.py\n")),(0,a.kt)("p",null,'Et si vous aviez lanc\xe9 le notebook avec l\'option "--userbase" (Exemple : ',(0,a.kt)("inlineCode",{parentName:"p"},'runJupyterSession.sh --container rapids --userbase "${HOME}/myenv3"'),"), alors vous devrez ajouter ",(0,a.kt)("inlineCode",{parentName:"p"},'--env "PYTHONUSERBASE=${HOME}/myenv3"')," \xe0 la commande de lancement apptainer :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'apptainer exec --env "PYTHONUSERBASE=${HOME}/myenv3" --bind /tmpdir,/work --nv /work/conteneurs/sessions-interactives/modulus-24.01-calmip-si.sif-si.sif /usr/local/bin/proxychains.sh python monscript.py\n')))),(0,a.kt)("p",null,"Voici quelques liens pour avoir de l'information suppl\xe9mentaire :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Sur l'",(0,a.kt)("a",{parentName:"li",href:"../apptainer.md"},"utilisation des conteneurs")," sur Turpan"),(0,a.kt)("li",{parentName:"ul"},"Sur l'",(0,a.kt)("a",{parentName:"li",href:"/documentation/user-documentation/arch_exp/turpan/logiciels/envpython/pytorch"},"utilisation de la biblioth\xe8que Pytorch")," sur Turpan"),(0,a.kt)("li",{parentName:"ul"},"Sur l'",(0,a.kt)("a",{parentName:"li",href:"/documentation/user-documentation/arch_exp/turpan/logiciels/envpython/tensorflow"},"utilisation de la biblioth\xe8que TensorFlow")," sur Turpan"),(0,a.kt)("li",{parentName:"ul"},"Sur l'",(0,a.kt)("a",{parentName:"li",href:"/documentation/user-documentation/arch_exp/turpan/logiciels/envpython/scikit-learn"},"utilisation de la biblioth\xe8que Scikit-learn")," sur Turpan"),(0,a.kt)("li",{parentName:"ul"},"Sur l'",(0,a.kt)("a",{parentName:"li",href:"/documentation/user-documentation/arch_exp/turpan/logiciels/envpython/modulus"},"utilisation de la biblioth\xe8que modulus")," sur Turpan")),(0,a.kt)("h2",{id:"comment-arr\xeater-une-session-interactive-de-notebook-jupyter"},"Comment arr\xeater une session interactive de notebook jupyter"),(0,a.kt)("p",null,"Vous pouvez arr\xeater la session interactive de notebook jupyter de 2 fa\xe7on :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Soit en allant sur le terminal dans lequel vous avez lanc\xe9 runJupyterSession.sh, et tapez :",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"CTRL-C\n"))),(0,a.kt)("li",{parentName:"ul"},'Soit en cliquant sur le bouton "Quit" de l\u2019interface du notebook jupyter',(0,a.kt)("admonition",{parentName:"li",type:"tip"},(0,a.kt)("p",{parentName:"admonition"},'Depuis un notebook actif, il faut d\'abord quitter le notebook ("File"->"Close and Halt") afin de pouvoir visualiser le bouton "Quit".')))),(0,a.kt)("h2",{id:"si-\xe7a-ne-fonctionne-pas"},"Si \xe7a ne fonctionne pas"),(0,a.kt)("p",null,"Avant de contacter le support, vous pouvez essayer les actions suivantes :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"V\xe9rifier que le terminal contenant la session est toujours actif"),(0,a.kt)("li",{parentName:"ul"},"V\xe9rifier que le terminal contenant le tunnel SSH est toujours actif"),(0,a.kt)("li",{parentName:"ul"},"V\xe9rifier que vous n'avez pas de session de notebook jupyter en local sur votre poste de travail qui utilise d\xe9j\xe0 le port 8888"),(0,a.kt)("li",{parentName:"ul"},"Tuer toutes vos connexions ssh \xe0 destination de Turpan et recommencer une session interactive"),(0,a.kt)("li",{parentName:"ul"},"Si vous \xeates sous windows, relancer votre session mobaxterm")))}k.isMDXComponent=!0}}]);