"use strict";(self.webpackChunkmesodocs=self.webpackChunkmesodocs||[]).push([[1821],{4137:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>f});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=r.createContext({}),u=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},c=function(e){var n=u(e.components);return r.createElement(l.Provider,{value:n},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,s=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=u(t),d=o,f=m["".concat(l,".").concat(d)]||m[d]||p[d]||s;return t?r.createElement(f,a(a({ref:n},c),{},{components:t})):r.createElement(f,a({ref:n},c))}));function f(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var s=t.length,a=new Array(s);a[0]=d;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i[m]="string"==typeof e?e:o,a[1]=i;for(var u=2;u<s;u++)a[u]=t[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},3392:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>u});var r=t(7462),o=(t(7294),t(4137));const s={title:"Lancer un calcul",sidebar_position:4},a="Lancer un calcul",i={unversionedId:"code_form/hedy/jobs",id:"code_form/hedy/jobs",title:"Lancer un calcul",description:"Les calculs ne doivent jamais \xeatre ex\xe9cut\xe9s sur les frontales de login mais sur les n\u0153uds de calcul.",source:"@site/docs/code_form/hedy/jobs.md",sourceDirName:"code_form/hedy",slug:"/code_form/hedy/jobs",permalink:"/documentation/user-documentation/code_form/hedy/jobs",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Lancer un calcul",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Comptabilit\xe9 et quotas",permalink:"/documentation/user-documentation/code_form/hedy/quotas"},next:{title:"Environnements logiciels",permalink:"/documentation/user-documentation/code_form/hedy/module"}},l={},u=[{value:"Soumission par script",id:"soumission-par-script",level:2},{value:"Soumission en ligne de commande",id:"soumission-en-ligne-de-commande",level:2},{value:"Ouverture d\u2019une session interactive",id:"ouverture-dune-session-interactive",level:2},{value:"Pour aller plus loin",id:"pour-aller-plus-loin",level:2}],c={toc:u},m="wrapper";function p(e){let{components:n,...t}=e;return(0,o.kt)(m,(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"lancer-un-calcul"},"Lancer un calcul"),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Les calculs ne doivent jamais \xeatre ex\xe9cut\xe9s sur les frontales de login mais sur les n\u0153uds de calcul.")),(0,o.kt)("p",null,"Il n\u2019y a pas d'espace scratch global sur la machine Hedy. Le disque local des n\u0153uds, de technologie NVMe offre de bonnes performances en lecture/\xe9criture et fait office de scratch. L\u2019usage recommand\xe9 est de copier au d\xe9but du job les donn\xe9es d\u2019entr\xe9e sur le r\xe9pertoire /tmp (si elles ne sont pas trop volumineuses) et, \xe0 l'issue de l'ex\xe9cution du programme, de d\xe9placer les r\xe9sultats depuis /tmp vers le home. Cette \xe9tape est essentielle car toutes les donn\xe9es seront supprim\xe9es du n\u0153ud \xe0 la fin du job."),(0,o.kt)("p",null,"Hedy utilise l\u2019ordonnanceur ",(0,o.kt)("a",{parentName:"p",href:"https://slurm.schedmd.com/overview.html"},"Slurm")," qui assure l\u2019ordonnancement et la planification des travaux de calcul. La soumission \xe0 Slurm des travaux de calcul se fait \xe0 partir d'un script shell ou en ligne de commande. "),(0,o.kt)("h2",{id:"soumission-par-script"},"Soumission par script"),(0,o.kt)("p",null,"Il faut \xe9crire un script shell comportant les directives Slurm (#SBATCH) et les commandes appropri\xe9es. "),(0,o.kt)("p",null,"Exemple de script shell qui sollicite la r\xe9servation pour 24 heures de 2 GPUs GH100 et ex\xe9cute le programme mon_programme.sh : "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"#!/bin/bash\n#SBATCH --job-name=mon_job_gpu\n#SBATCH --account=b1001\n#SBATCH --partition=gpu\n#SBATCH --nodes=1\n#SBATCH --gres=gpu:GH100:2 \n#SBATCH --time=24:00:00 \n\n# copie des donn\xe9es d\u2019entr\xe9e sur le n\u0153ud allou\xe9\nmkdir /tmp/input\ncp /home/user/.../* /tmp/input/.\n\n# lancement du programme\n~/soft/.../mon_progamme\n\n# d\xe9placement des r\xe9sultats sur le home\nmv /tmp/output/* /home/user/\u2026/.\n")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"L'allocation des ressources est bas\xe9e sur l'utilisation du GPU, on vous demande donc de NE PAS indiquer le nombre de c\u0153urs CPU et la m\xe9moire requise dans un Job car ces ressources seront allou\xe9es automatiquement, aussi efficacement que possible, en fonction du nombre de GPU (",(0,o.kt)("inlineCode",{parentName:"p"},"CPU = nombre_de_GPUs * 16 c\u0153urs")," , ",(0,o.kt)("inlineCode",{parentName:"p"},"RAM = nombre_de_GPUs * 120000 MB"),").")),(0,o.kt)("p",null,"Il suffit ensuite d'envoyer le script \xe0 Slurm par la commande sbatch qui le mettra en file d'attente."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sbatch mon_programme.sh\n")),(0,o.kt)("h2",{id:"soumission-en-ligne-de-commande"},"Soumission en ligne de commande"),(0,o.kt)("p",null,"Il est possible d'utiliser directement sbatch en ligne de commande avec pour arguments les directives Slurm et le nom du programme. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"srun --job-name=mon_job_gpu --account=b1001 --partition=gpu --nodes=1 --gres=gpu:GH100:2 --time=24:00:00 mon_script.sh\n")),(0,o.kt)("h2",{id:"ouverture-dune-session-interactive"},"Ouverture d\u2019une session interactive"),(0,o.kt)("p",null,"Il est \xe9galement possible d'acc\xe9der \xe0 une session interactive en pr\xe9cisant les ressources souhait\xe9es. "),(0,o.kt)("p",null,"Par exemple : "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"srun --job-name=mon_job_gpu --account=b1001 --partition=gpu --nodes=1 --gres=gpu:GH100:2 --time=24:00:00 --pty bash -i\n")),(0,o.kt)("p",null,"Vous serez alors connect\xe9 sur un n\u0153ud et pourrez utiliser les commandes unix et lancer vos directement en ligne de commande."),(0,o.kt)("h2",{id:"pour-aller-plus-loin"},"Pour aller plus loin"),(0,o.kt)("p",null,"Quelques tutoriels sur Slurm sont disponibles ",(0,o.kt)("a",{parentName:"p",href:"/documentation/user-documentation/HOWTO/slurm/"},"ici"),", la liste compl\xe8te des directives Slum est disponible ",(0,o.kt)("a",{parentName:"p",href:"https://slurm.schedmd.com/archive/slurm-24.05.5/sbatch.html#lbAG"},"ici")," et la documentation compl\xe8te ",(0,o.kt)("a",{parentName:"p",href:"https://slurm.schedmd.com/archive/slurm-24.05.5/"},"ici"),"."))}p.isMDXComponent=!0}}]);