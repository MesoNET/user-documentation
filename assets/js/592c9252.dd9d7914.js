"use strict";(self.webpackChunkmesodocs=self.webpackChunkmesodocs||[]).push([[1825],{4137:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>b});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=r.createContext({}),s=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):u(u({},t),e)),n},c=function(e){var t=s(e.components);return r.createElement(i.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=s(n),d=a,b=p["".concat(i,".").concat(d)]||p[d]||m[d]||o;return n?r.createElement(b,u(u({ref:t},c),{},{components:n})):r.createElement(b,u({ref:t},c))}));function b(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,u=new Array(o);u[0]=d;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[p]="string"==typeof e?e:a,u[1]=l;for(var s=2;s<o;s++)u[s]=n[s];return r.createElement.apply(null,u)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},425:(e,t,n)=>{n.d(t,{Z:()=>u});var r=n(7294),a=n(6010);const o={tabItem:"tabItem_Ymn6"};function u(e){let{children:t,hidden:n,className:u}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(o.tabItem,u),hidden:n},t)}},3992:(e,t,n)=>{n.d(t,{Z:()=>N});var r=n(7462),a=n(7294),o=n(6010),u=n(2957),l=n(6550),i=n(5238),s=n(3609),c=n(2560);function p(e){return function(e){return a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:a}}=e;return{value:t,label:n,attributes:r,default:a}}))}function m(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,s.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function d(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function b(e){let{queryString:t=!1,groupId:n}=e;const r=(0,l.k6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,i._X)(o),(0,a.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(r.location.search);t.set(o,e),r.replace({...r.location,search:t.toString()})}),[o,r])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,o=m(e),[u,l]=(0,a.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!d({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:o}))),[i,s]=b({queryString:n,groupId:r}),[p,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,o]=(0,c.Nk)(n);return[r,(0,a.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:r}),f=(()=>{const e=i??p;return d({value:e,tabValues:o})?e:null})();(0,a.useLayoutEffect)((()=>{f&&l(f)}),[f]);return{selectedValue:u,selectValue:(0,a.useCallback)((e=>{if(!d({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),s(e),g(e)}),[s,g,o]),tabValues:o}}var f=n(1048);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function k(e){let{className:t,block:n,selectedValue:l,selectValue:i,tabValues:s}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,u.o5)(),m=e=>{const t=e.currentTarget,n=c.indexOf(t),r=s[n].value;r!==l&&(p(t),i(r))},d=e=>{let t=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t)},s.map((e=>{let{value:t,label:n,attributes:u}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>c.push(e),onKeyDown:d,onClick:m},u,{className:(0,o.Z)("tabs__item",v.tabItem,u?.className,{"tabs__item--active":l===t})}),n??t)})))}function h(e){let{lazy:t,children:n,selectedValue:r}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},o.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function y(e){const t=g(e);return a.createElement("div",{className:(0,o.Z)("tabs-container",v.tabList)},a.createElement(k,(0,r.Z)({},e,t)),a.createElement(h,(0,r.Z)({},e,t)))}function N(e){const t=(0,f.Z)();return a.createElement(y,(0,r.Z)({key:String(t)},e))}},601:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>b,frontMatter:()=>l,metadata:()=>s,toc:()=>p});var r=n(7462),a=(n(7294),n(4137)),o=n(3992),u=n(425);const l={},i=void 0,s={unversionedId:"arch_exp/turpan/soumettre_calcul/MIG",id:"arch_exp/turpan/soumettre_calcul/MIG",title:"MIG",description:"Les GPU A100 sont puissants, mais parfois une application n\u2019a pas besoin de toute la capacit\xe9 du GPU. La technologie MIG (Multi-Instance GPU) de NVIDIA permet de partitionner un seul GPU en plusieurs instances plus petites, chacune avec sa propre m\xe9moire, ses c\u0153urs et ses ressources de calcul d\xe9di\xe9es.",source:"@site/docs/arch_exp/turpan/soumettre_calcul/MIG.md",sourceDirName:"arch_exp/turpan/soumettre_calcul",slug:"/arch_exp/turpan/soumettre_calcul/MIG",permalink:"/documentation/user-documentation/arch_exp/turpan/soumettre_calcul/MIG",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Lancer un calcul",permalink:"/documentation/user-documentation/arch_exp/turpan/soumettre_calcul/"},next:{title:"Le stockage",permalink:"/documentation/user-documentation/arch_exp/turpan/stockage"}},c={},p=[{value:"\xc0 propos de MIG sur Turpan",id:"\xe0-propos-de-mig-sur-turpan",level:2},{value:"3g.40gb",id:"3g40gb",level:4},{value:"2g.20gb",id:"2g20gb",level:4},{value:"Quand utiliser MIG",id:"quand-utiliser-mig",level:2},{value:"Comment utiliser MIG",id:"comment-utiliser-mig",level:2}],m={toc:p},d="wrapper";function b(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Les GPU A100 sont puissants, mais parfois une application n\u2019a pas besoin de toute la capacit\xe9 du GPU. La technologie MIG (Multi-Instance GPU) de NVIDIA permet de partitionner un seul GPU en plusieurs instances plus petites, chacune avec sa propre m\xe9moire, ses c\u0153urs et ses ressources de calcul d\xe9di\xe9es."),(0,a.kt)("p",null,"L\u2019utilisation de MIG am\xe9liorera l\u2019efficacit\xe9 de la machine et r\xe9duira aussi ",(0,a.kt)("a",{parentName:"p",href:"/documentation/user-documentation/arch_exp/turpan/accounting/accounting-rules"},"votre consommation d\u2019heures")," au lieu d'utiliser Shared ou Full n\u0153ud.  "),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Pour savoir si votre application doit utiliser un MIG ou non, essayez-la d\u2019abord sur un GPU complet et utilisez ",(0,a.kt)("inlineCode",{parentName:"p"},"placement")," pour observer l\u2019utilisation du GPU ",(0,a.kt)("inlineCode",{parentName:"p"},"placement --jobid={your_job_id}")," qui permet de voir l\u2019utilisation du GPU et de la m\xe9moire, sachant qu\u2019un GPU complet dispose de 80 Go de m\xe9moire.")),(0,a.kt)("h2",{id:"\xe0-propos-de-mig-sur-turpan"},"\xc0 propos de MIG sur Turpan"),(0,a.kt)("p",null,"Il existe 2 types d\u2019instances MIG sur Turpan :"),(0,a.kt)("h4",{id:"3g40gb"},"3g.40gb"),(0,a.kt)("p",null,"Cela repr\xe9sente environ 57 % d\u2019un GPU A100 complet. \xc0 prendre en compte dans cette configuration :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Le nombre de c\u0153urs CPU disponibles sur cette configuration est ",(0,a.kt)("inlineCode",{parentName:"li"},"20 cores")," "),(0,a.kt)("li",{parentName:"ul"},"La m\xe9moire disponible est ",(0,a.kt)("inlineCode",{parentName:"li"},"40 GB"))),(0,a.kt)("h4",{id:"2g20gb"},"2g.20gb"),(0,a.kt)("p",null,"Cela repr\xe9sente environ 40 % d\u2019un GPU A100 complet. \xc0 prendre en compte dans cette configuration :"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Le nombre de c\u0153urs CPU disponibles sur cette configuration est  ",(0,a.kt)("inlineCode",{parentName:"li"},"10 cores")," "),(0,a.kt)("li",{parentName:"ul"},"La m\xe9moire disponible est ",(0,a.kt)("inlineCode",{parentName:"li"},"20 GB"))),(0,a.kt)("h2",{id:"quand-utiliser-mig"},"Quand utiliser MIG"),(0,a.kt)("p",null,"Apr\xe8s avoir ex\xe9cut\xe9 votre code une premi\xe8re fois sur un GPU complet, utilisez placement pour analyser l\u2019usage du GPU."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Si votre ",(0,a.kt)("strong",{parentName:"li"},"code utilise entre 50 % et 35 %"),", moins de 20 c\u0153urs et moins de 40 Go de m\xe9moire, utilisez ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"strong"},"3g.40gb")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Si votre code a besoin de plus de 40 Go ou de plus de 20 c\u0153urs, restez sur le GPU complet."))),(0,a.kt)("li",{parentName:"ul"},"Si votre ",(0,a.kt)("strong",{parentName:"li"},"code utilise moins de 35 %"),", 10 c\u0153urs et moins de 20 Go de m\xe9moire, utilisez ",(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"strong"},"2g.20gb")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Si vous avez besoin de plus de 10 c\u0153urs mais moins de 20, ou de plus de 20 Go de m\xe9moire mais moins de 40 Go, suivez les indications de la configuration ",(0,a.kt)("inlineCode",{parentName:"li"},"3g.40gb"),". ")))),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"MIG est utilisable uniquement si votre application n\u2019a besoin que d\u2019un seul GPU.")),(0,a.kt)("h2",{id:"comment-utiliser-mig"},"Comment utiliser MIG"),(0,a.kt)(o.Z,{mdxType:"Tabs"},(0,a.kt)(u.Z,{label:"3g.40gb",value:"3g.40gb",mdxType:"TabItem"},(0,a.kt)("blockquote",null,(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre"},"#!/bin/bash\n#SBATCH -N 1\n#SBATCH -n 20\n#SBATCH --gres=gpu:3g.40gb \n#SBATCH -p 3g.40gb\n\nmodule purge\nmodule load gnu/11.2.0\nmodule load openmpi/gnu/4.1.4-gpu\n\nmpirun -n 20 ./exec\n")))),(0,a.kt)(u.Z,{label:"2g.20gb",value:"2g.20gb",mdxType:"TabItem"},(0,a.kt)("blockquote",null,(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre"},"#!/bin/bash\n#SBATCH -N 1\n#SBATCH -n 10\n#SBATCH --gres=gpu:2g.20gb \n#SBATCH -p 2g.20gb\n\nmodule purge\nmodule load gnu/11.2.0\nmodule load openmpi/gnu/4.1.4-gpu\n\nmpirun -n 10 ./exec\n"))))),(0,a.kt)("admonition",{title:"Important",type:"danger"},(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"Impossible d\u2019utiliser plus d\u2019une instance MIG par job."),(0,a.kt)("li",{parentName:"ul"},"\xc9vitez l\u2019option --gpus-per-task, car elle consid\xe8re automatiquement un GPU complet."))))}b.isMDXComponent=!0}}]);