"use strict";(self.webpackChunkmesodocs=self.webpackChunkmesodocs||[]).push([[5158],{4137:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>k});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},l=Object.keys(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),p=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=p(a),m=n,k=d["".concat(s,".").concat(m)]||d[m]||c[m]||l;return a?r.createElement(k,i(i({ref:t},u),{},{components:a})):r.createElement(k,i({ref:t},u))}));function k(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,i=new Array(l);i[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[d]="string"==typeof e?e:n,i[1]=o;for(var p=2;p<l;p++)i[p]=a[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},115:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var r=a(7462),n=(a(7294),a(4137));const l={title:"Lancer un calcul",sidebar_position:6},i="Lancer un calcul sur Arctic",o={unversionedId:"code_form/arctic/jobs",id:"code_form/arctic/jobs",title:"Lancer un calcul",description:"Commandes de Slurm",source:"@site/docs/code_form/arctic/jobs.md",sourceDirName:"code_form/arctic",slug:"/code_form/arctic/jobs",permalink:"/documentation/user-documentation/code_form/arctic/jobs",draft:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Lancer un calcul",sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Environnements logiciels",permalink:"/documentation/user-documentation/code_form/arctic/logiciels"},next:{title:"Service Jupyterhub",permalink:"/documentation/user-documentation/code_form/arctic/jupyter"}},s={},p=[{value:"Commandes de Slurm",id:"commandes-de-slurm",level:2},{value:"Mod\xe8les de script",id:"mod\xe8les-de-script",level:2},{value:"Les partitions (classes de soumission)",id:"les-partitions-classes-de-soumission",level:2},{value:"Domaine IA - deep learning",id:"domaine-ia---deep-learning",level:2},{value:"GPU partitionn\xe9s",id:"gpu-partitionn\xe9s",level:2}],u={toc:p},d="wrapper";function c(e){let{components:t,...a}=e;return(0,n.kt)(d,(0,r.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"lancer-un-calcul-sur-arctic"},"Lancer un calcul sur Arctic"),(0,n.kt)("h2",{id:"commandes-de-slurm"},"Commandes de Slurm"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Action"),(0,n.kt)("th",{parentName:"tr",align:null},"Commande"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Caract\xe9ristiques des partitions (classes)"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"sinfo"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Soumettre un travail"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"sbatch slurm_script.sl"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Lister l'ensemble des travaux"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"squeue"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Lister ses propres travaux"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"squeue --me"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Affichage des caract\xe9ristiques d'un travail"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"scontrol show job job_id"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Pr\xe9vision d'horaire de passage d'un travail en file d'attente"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"squeue --start --job job_id"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Pr\xe9vision d'horaire de passage de ses propres travaux"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"squeue --me --start"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"V\xe9rification de la syntaxe et pr\xe9vision d'horaire de passage d'un travail, sans le soumettre"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"sbatch --test-only slurm_script.sl"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Tuer un travail"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"scancel job_id"))))),(0,n.kt)("h2",{id:"mod\xe8les-de-script"},"Mod\xe8les de script"),(0,n.kt)("p",null,"Les mod\xe8les de script sont fournis dans un r\xe9pertoire ",(0,n.kt)("inlineCode",{parentName:"p"},"/soft/slurm/Arctic_Modeles_scripts/")),(0,n.kt)("h2",{id:"les-partitions-classes-de-soumission"},"Les partitions (classes de soumission)"),(0,n.kt)("p",null,"La partition Slurm est \xe0 sp\xe9cifier par l'utilisateur dans son script. "),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Partition"),(0,n.kt)("th",{parentName:"tr",align:null},"Dur\xe9e maximale"),(0,n.kt)("th",{parentName:"tr",align:null},"Limites par calcul"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("strong",{parentName:"td"},"ar_mig")),(0,n.kt)("td",{parentName:"tr",align:null},"8 h"),(0,n.kt)("td",{parentName:"tr",align:null},"4 c\u0153urs, 1 instance de GPU NVIDIA A100 partitionn\xe9 en MIG")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("strong",{parentName:"td"},"ar_a100")),(0,n.kt)("td",{parentName:"tr",align:null},"8 h"),(0,n.kt)("td",{parentName:"tr",align:null},"16 c\u0153urs, 1 GPU NVIDIA A100")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("strong",{parentName:"td"},"ar_h200")),(0,n.kt)("td",{parentName:"tr",align:null},"8 h"),(0,n.kt)("td",{parentName:"tr",align:null},"24 c\u0153urs, 1 GPU NVIDIA H200")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("strong",{parentName:"td"},"ar_mi210")),(0,n.kt)("td",{parentName:"tr",align:null},"1 h"),(0,n.kt)("td",{parentName:"tr",align:null},"16 c\u0153urs, 1 GPU AMD MI210")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("strong",{parentName:"td"},"ar_fin")),(0,n.kt)("td",{parentName:"tr",align:null},"1 h"),(0,n.kt)("td",{parentName:"tr",align:null},"384 c\u0153urs (2 n\u0153uds de calcul purs CPU, AMD Genoa)")))),(0,n.kt)("h2",{id:"domaine-ia---deep-learning"},"Domaine IA - deep learning"),(0,n.kt)("p",null,"Lire sa ",(0,n.kt)("a",{parentName:"p",href:"https://services.criann.fr/services/hpc/cluster-austral/guide/ia-deep-learning"},"page consacr\xe9e")," et sa section ",(0,n.kt)("strong",{parentName:"p"},"Utilisation")," (les partitions Slurm pour GPU NVIDIA mentionn\xe9es sur ce lien sont \xe0 remplacer par celles du tableau ci-dessus)."),(0,n.kt)("h2",{id:"gpu-partitionn\xe9s"},"GPU partitionn\xe9s"),(0,n.kt)("p",null,"La partition ",(0,n.kt)("inlineCode",{parentName:"p"},"ar_mig")," est associ\xe9e \xe0 un n\u0153ud de calcul dont les GPU NVIDIA A100 sont partitionn\xe9s par la technologie MIG (Multi-Instance GPU)."),(0,n.kt)("p",null,"Diff\xe9rentes tailles d'instances sont disponibles (SM : Streaming Multiprocessor, TC : Tensor Core) :"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"10 devices a100_1g.10gb avec 10 GB de m\xe9moire, 14 SM et 56 TC"),(0,n.kt)("li",{parentName:"ul"},"17 devices a100_2g.20gb avec 20 GB de m\xe9moire, 28 SM et 108 TC"),(0,n.kt)("li",{parentName:"ul"},"4 devices a100_3g.40gb avec 40 GB de m\xe9moire, 42 SM et 164 TC")),(0,n.kt)("p",null,"Pour utiliser l'un de ces devices dans vos calculs il faut :"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"cibler la partition ",(0,n.kt)("inlineCode",{parentName:"li"},"ar_mig")," avec l'option ",(0,n.kt)("inlineCode",{parentName:"li"},"--partition ar_mig")," de sbatch"),(0,n.kt)("li",{parentName:"ul"},"pr\xe9ciser le type de device souhait\xe9 avec l'option ",(0,n.kt)("inlineCode",{parentName:"li"},"--gres")," de sbatch :",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"--gres=gpu:a100_1g.10gb")," pour l'architecture a100_1g.10gb"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"--gres=gpu:a100_2g.20gb")," pour l'architecture a100_2g.20gb"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"--gres=gpu:a100_3g.40gb")," pour l'architecture a100_3g.40gb")))),(0,n.kt)("p",null,"Un exemple complet bas\xe9 sur le tutoriel mnist pour PyTorch est disponible sur Arctic, dans le r\xe9pertoire :"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"/soft/slurm/Arctic_Modeles_scripts/pytorch-mig/")))}c.isMDXComponent=!0}}]);